var $r=Object.defineProperty;var es=(l,e,n)=>e in l?$r(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n;var Ie=(l,e,n)=>es(l,typeof e!="symbol"?e+"":e,n);import{a as ts,r as J}from"./vendor-react-DEhD4NTb.js";import{D as Kn,c as Be,O as Rt,P as Pt,V as xe,g as ns,h as rs,i as _n,j as Ir,M as sn,I as ss,k as tn,Q as pn,l as ar,m as xt,n as Lt,o as as,p as is,q as Qn,r as qt,F as Bt,s as pt,t as os,u as cs,v as ls,w as Ot,x as et,y as mn,z as us,E as As,G as Fr,H as hs,J as ds,K as $t,X as fs,Y as je,Z as Tr,_ as xn,$ as Bs,a0 as Tn,a1 as ps,a2 as Rr,a3 as ms,a4 as Dr,a5 as Cs,a6 as gs,a7 as Es,a8 as vs,a9 as Ms,aa as Rn,ab as Is,ac as Fs,ad as Ts,ae as Rs,af as br,ag as Ds,ah as bs,ai as ys,aj as Gs,ak as at,al as ws,am as Ss,an as Hs,ao as _s,ap as dt,aq as ir,ar as or,as as cr,at as xs,au as Ls,av as Os,aw as yr,ax as Ye,ay as it,az as Ut,R as nn,aA as Us,S as Gr,aB as Xn,aC as Cn,aD as gn,W as Ps,aE as Js,aF as Ln,aG as Ns,aH as ks,aI as Ks,aJ as Qs,U as On,aK as Xs,aL as lr,aM as js,aN as Ys,aO as Zs,aP as Ws,aQ as Vs,aR as zs,aS as qs}from"./vendor-three-TpfQuS_g.js";import{u as we,a as vn,b as Dt,c as $s,e as ea,d as ur}from"./vendor-r3f-C5e-dI0K.js";var wr,Ar=ts;wr=Ar.createRoot,Ar.hydrateRoot;const ta="modulepreload",na=function(l,e){return new URL(l,e).href},hr={},Qi=function(e,n,t){let r=Promise.resolve();if(n&&n.length>0){const a=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),o=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));r=Promise.allSettled(n.map(A=>{if(A=na(A,t),A in hr)return;hr[A]=!0;const h=A.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(!!t)for(let g=a.length-1;g>=0;g--){const T=a[g];if(T.href===A&&(!h||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${A}"]${d}`))return;const m=document.createElement("link");if(m.rel=h?"stylesheet":ta,h||(m.as="script"),m.crossOrigin="",m.href=A,o&&m.setAttribute("nonce",o),document.head.appendChild(m),h)return new Promise((g,T)=>{m.addEventListener("load",g),m.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${A}`)))})}))}function s(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return r.then(a=>{for(const c of a||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})};function kt(){return kt=Object.assign?Object.assign.bind():function(l){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)({}).hasOwnProperty.call(n,t)&&(l[t]=n[t])}return l},kt.apply(null,arguments)}const an=new Be,jn=new Be,ra=new Be,dr=new xe;function sa(l,e,n){const t=an.setFromMatrixPosition(l.matrixWorld);t.project(e);const r=n.width/2,s=n.height/2;return[t.x*r+r,-(t.y*s)+s]}function aa(l,e){const n=an.setFromMatrixPosition(l.matrixWorld),t=jn.setFromMatrixPosition(e.matrixWorld),r=n.sub(t),s=e.getWorldDirection(ra);return r.angleTo(s)>Math.PI/2}function ia(l,e,n,t){const r=an.setFromMatrixPosition(l.matrixWorld),s=r.clone();s.project(e),dr.set(s.x,s.y),n.setFromCamera(dr,e);const a=n.intersectObjects(t,!0);if(a.length){const c=a[0].distance;return r.distanceTo(n.ray.origin)<c}return!0}function oa(l,e){if(e instanceof Rt)return e.zoom;if(e instanceof Pt){const n=an.setFromMatrixPosition(l.matrixWorld),t=jn.setFromMatrixPosition(e.matrixWorld),r=e.fov*Math.PI/180,s=n.distanceTo(t);return 1/(2*Math.tan(r/2)*s)}else return 1}function ca(l,e,n){if(e instanceof Pt||e instanceof Rt){const t=an.setFromMatrixPosition(l.matrixWorld),r=jn.setFromMatrixPosition(e.matrixWorld),s=t.distanceTo(r),a=(n[1]-n[0])/(e.far-e.near),c=n[1]-a*e.far;return Math.round(a*s+c)}}const Un=l=>Math.abs(l)<1e-10?0:l;function Sr(l,e,n=""){let t="matrix3d(";for(let r=0;r!==16;r++)t+=Un(e[r]*l.elements[r])+(r!==15?",":")");return n+t}const la=(l=>e=>Sr(e,l))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),ua=(l=>(e,n)=>Sr(e,l(n),"translate(-50%,-50%)"))(l=>[1/l,1/l,1/l,1,-1/l,-1/l,-1/l,-1,1/l,1/l,1/l,1,1,1,1,1]);function Aa(l){return l&&typeof l=="object"&&"current"in l}const Xi=J.forwardRef(({children:l,eps:e=.001,style:n,className:t,prepend:r,center:s,fullscreen:a,portal:c,distanceFactor:o,sprite:A=!1,transform:h=!1,occlude:d,onOcclude:B,castShadow:m,receiveShadow:g,material:T,geometry:M,zIndexRange:D=[16777271,0],calculatePosition:x=sa,as:N="div",wrapperClass:P,pointerEvents:O="auto",...b},Z)=>{const{gl:F,camera:I,scene:U,size:Y,raycaster:$,events:z,viewport:K}=we(),[V]=J.useState(()=>document.createElement(N)),W=J.useRef(),le=J.useRef(null),Me=J.useRef(0),ge=J.useRef([0,0]),ee=J.useRef(null),Ee=J.useRef(null),se=(c==null?void 0:c.current)||z.connected||F.domElement.parentNode,oe=J.useRef(null),Te=J.useRef(!1),Ue=J.useMemo(()=>d&&d!=="blending"||Array.isArray(d)&&d.length&&Aa(d[0]),[d]);J.useLayoutEffect(()=>{const be=F.domElement;d&&d==="blending"?(be.style.zIndex=`${Math.floor(D[0]/2)}`,be.style.position="absolute",be.style.pointerEvents="none"):(be.style.zIndex=null,be.style.position=null,be.style.pointerEvents=null)},[d]),J.useLayoutEffect(()=>{if(le.current){const be=W.current=wr(V);if(U.updateMatrixWorld(),h)V.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const ce=x(le.current,I,Y);V.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${ce[0]}px,${ce[1]}px,0);transform-origin:0 0;`}return se&&(r?se.prepend(V):se.appendChild(V)),()=>{se&&se.removeChild(V),be.unmount()}}},[se,h]),J.useLayoutEffect(()=>{P&&(V.className=P)},[P]);const ae=J.useMemo(()=>h?{position:"absolute",top:0,left:0,width:Y.width,height:Y.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...a&&{top:-Y.height/2,left:-Y.width/2,width:Y.width,height:Y.height},...n},[n,s,a,Y,h]),Le=J.useMemo(()=>({position:"absolute",pointerEvents:O}),[O]);J.useLayoutEffect(()=>{if(Te.current=!1,h){var be;(be=W.current)==null||be.render(J.createElement("div",{ref:ee,style:ae},J.createElement("div",{ref:Ee,style:Le},J.createElement("div",{ref:Z,className:t,style:n,children:l}))))}else{var ce;(ce=W.current)==null||ce.render(J.createElement("div",{ref:Z,style:ae,className:t,children:l}))}});const Re=J.useRef(!0);vn(be=>{if(le.current){I.updateMatrixWorld(),le.current.updateWorldMatrix(!0,!1);const ce=h?ge.current:x(le.current,I,Y);if(h||Math.abs(Me.current-I.zoom)>e||Math.abs(ge.current[0]-ce[0])>e||Math.abs(ge.current[1]-ce[1])>e){const Pe=aa(le.current,I);let Se=!1;Ue&&(Array.isArray(d)?Se=d.map(Je=>Je.current):d!=="blending"&&(Se=[U]));const Ze=Re.current;if(Se){const Je=ia(le.current,I,$,Se);Re.current=Je&&!Pe}else Re.current=!Pe;Ze!==Re.current&&(B?B(!Re.current):V.style.display=Re.current?"block":"none");const tt=Math.floor(D[0]/2),Kt=d?Ue?[D[0],tt]:[tt-1,0]:D;if(V.style.zIndex=`${ca(le.current,I,Kt)}`,h){const[Je,mt]=[Y.width/2,Y.height/2],ct=I.projectionMatrix.elements[5]*mt,{isOrthographicCamera:yt,top:Qt,left:Gt,bottom:lt,right:nt}=I,Ct=la(I.matrixWorldInverse),Xt=yt?`scale(${ct})translate(${Un(-(nt+Gt)/2)}px,${Un((Qt+lt)/2)}px)`:`translateZ(${ct}px)`;let Ne=le.current.matrixWorld;A&&(Ne=I.matrixWorldInverse.clone().transpose().copyPosition(Ne).scale(le.current.scale),Ne.elements[3]=Ne.elements[7]=Ne.elements[11]=0,Ne.elements[15]=1),V.style.width=Y.width+"px",V.style.height=Y.height+"px",V.style.perspective=yt?"":`${ct}px`,ee.current&&Ee.current&&(ee.current.style.transform=`${Xt}${Ct}translate(${Je}px,${mt}px)`,Ee.current.style.transform=ua(Ne,1/((o||10)/400)))}else{const Je=o===void 0?1:oa(le.current,I)*o;V.style.transform=`translate3d(${ce[0]}px,${ce[1]}px,0) scale(${Je})`}ge.current=ce,Me.current=I.zoom}}if(!Ue&&oe.current&&!Te.current)if(h){if(ee.current){const ce=ee.current.children[0];if(ce!=null&&ce.clientWidth&&ce!=null&&ce.clientHeight){const{isOrthographicCamera:Pe}=I;if(Pe||M)b.scale&&(Array.isArray(b.scale)?b.scale instanceof Be?oe.current.scale.copy(b.scale.clone().divideScalar(1)):oe.current.scale.set(1/b.scale[0],1/b.scale[1],1/b.scale[2]):oe.current.scale.setScalar(1/b.scale));else{const Se=(o||10)/400,Ze=ce.clientWidth*Se,tt=ce.clientHeight*Se;oe.current.scale.set(Ze,tt,1)}Te.current=!0}}}else{const ce=V.children[0];if(ce!=null&&ce.clientWidth&&ce!=null&&ce.clientHeight){const Pe=1/K.factor,Se=ce.clientWidth*Pe,Ze=ce.clientHeight*Pe;oe.current.scale.set(Se,Ze,1),Te.current=!0}oe.current.lookAt(be.camera.position)}});const bt=J.useMemo(()=>({vertexShader:h?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[h]);return J.createElement("group",kt({},b,{ref:le}),d&&!Ue&&J.createElement("mesh",{castShadow:m,receiveShadow:g,ref:oe},M||J.createElement("planeGeometry",null),T||J.createElement("shaderMaterial",{side:Kn,vertexShader:bt.vertexShader,fragmentShader:bt.fragmentShader})))}),Yn=parseInt(ns.replace(/\D+/g,""));function fr(l,e){if(e===rs)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),l;if(e===_n||e===Ir){let n=l.getIndex();if(n===null){const a=[],c=l.getAttribute("position");if(c!==void 0){for(let o=0;o<c.count;o++)a.push(o);l.setIndex(a),n=l.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),l}const t=n.count-2,r=[];if(n)if(e===_n)for(let a=1;a<=t;a++)r.push(n.getX(0)),r.push(n.getX(a)),r.push(n.getX(a+1));else for(let a=0;a<t;a++)a%2===0?(r.push(n.getX(a)),r.push(n.getX(a+1)),r.push(n.getX(a+2))):(r.push(n.getX(a+2)),r.push(n.getX(a+1)),r.push(n.getX(a)));r.length/3!==t&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=l.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),l}var Xe=Uint8Array,ft=Uint16Array,Pn=Uint32Array,Hr=new Xe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_r=new Xe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ha=new Xe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),xr=function(l,e){for(var n=new ft(31),t=0;t<31;++t)n[t]=e+=1<<l[t-1];for(var r=new Pn(n[30]),t=1;t<30;++t)for(var s=n[t];s<n[t+1];++s)r[s]=s-n[t]<<5|t;return[n,r]},Lr=xr(Hr,2),Or=Lr[0],da=Lr[1];Or[28]=258,da[258]=28;var fa=xr(_r,0),Ba=fa[0],Jn=new ft(32768);for(var me=0;me<32768;++me){var At=(me&43690)>>>1|(me&21845)<<1;At=(At&52428)>>>2|(At&13107)<<2,At=(At&61680)>>>4|(At&3855)<<4,Jn[me]=((At&65280)>>>8|(At&255)<<8)>>>1}var en=function(l,e,n){for(var t=l.length,r=0,s=new ft(e);r<t;++r)++s[l[r]-1];var a=new ft(e);for(r=0;r<e;++r)a[r]=a[r-1]+s[r-1]<<1;var c;if(n){c=new ft(1<<e);var o=15-e;for(r=0;r<t;++r)if(l[r])for(var A=r<<4|l[r],h=e-l[r],d=a[l[r]-1]++<<h,B=d|(1<<h)-1;d<=B;++d)c[Jn[d]>>>o]=A}else for(c=new ft(t),r=0;r<t;++r)l[r]&&(c[r]=Jn[a[l[r]-1]++]>>>15-l[r]);return c},on=new Xe(288);for(var me=0;me<144;++me)on[me]=8;for(var me=144;me<256;++me)on[me]=9;for(var me=256;me<280;++me)on[me]=7;for(var me=280;me<288;++me)on[me]=8;var Ur=new Xe(32);for(var me=0;me<32;++me)Ur[me]=5;var pa=en(on,9,1),ma=en(Ur,5,1),Dn=function(l){for(var e=l[0],n=1;n<l.length;++n)l[n]>e&&(e=l[n]);return e},ze=function(l,e,n){var t=e/8|0;return(l[t]|l[t+1]<<8)>>(e&7)&n},bn=function(l,e){var n=e/8|0;return(l[n]|l[n+1]<<8|l[n+2]<<16)>>(e&7)},Ca=function(l){return(l/8|0)+(l&7&&1)},ga=function(l,e,n){(n==null||n>l.length)&&(n=l.length);var t=new(l instanceof ft?ft:l instanceof Pn?Pn:Xe)(n-e);return t.set(l.subarray(e,n)),t},Ea=function(l,e,n){var t=l.length;if(!t||n&&!n.l&&t<5)return e||new Xe(0);var r=!e||n,s=!n||n.i;n||(n={}),e||(e=new Xe(t*3));var a=function(ae){var Le=e.length;if(ae>Le){var Re=new Xe(Math.max(Le*2,ae));Re.set(e),e=Re}},c=n.f||0,o=n.p||0,A=n.b||0,h=n.l,d=n.d,B=n.m,m=n.n,g=t*8;do{if(!h){n.f=c=ze(l,o,1);var T=ze(l,o+1,3);if(o+=3,T)if(T==1)h=pa,d=ma,B=9,m=5;else if(T==2){var N=ze(l,o,31)+257,P=ze(l,o+10,15)+4,O=N+ze(l,o+5,31)+1;o+=14;for(var b=new Xe(O),Z=new Xe(19),F=0;F<P;++F)Z[ha[F]]=ze(l,o+F*3,7);o+=P*3;for(var I=Dn(Z),U=(1<<I)-1,Y=en(Z,I,1),F=0;F<O;){var $=Y[ze(l,o,U)];o+=$&15;var M=$>>>4;if(M<16)b[F++]=M;else{var z=0,K=0;for(M==16?(K=3+ze(l,o,3),o+=2,z=b[F-1]):M==17?(K=3+ze(l,o,7),o+=3):M==18&&(K=11+ze(l,o,127),o+=7);K--;)b[F++]=z}}var V=b.subarray(0,N),W=b.subarray(N);B=Dn(V),m=Dn(W),h=en(V,B,1),d=en(W,m,1)}else throw"invalid block type";else{var M=Ca(o)+4,D=l[M-4]|l[M-3]<<8,x=M+D;if(x>t){if(s)throw"unexpected EOF";break}r&&a(A+D),e.set(l.subarray(M,x),A),n.b=A+=D,n.p=o=x*8;continue}if(o>g){if(s)throw"unexpected EOF";break}}r&&a(A+131072);for(var le=(1<<B)-1,Me=(1<<m)-1,ge=o;;ge=o){var z=h[bn(l,o)&le],ee=z>>>4;if(o+=z&15,o>g){if(s)throw"unexpected EOF";break}if(!z)throw"invalid length/literal";if(ee<256)e[A++]=ee;else if(ee==256){ge=o,h=null;break}else{var Ee=ee-254;if(ee>264){var F=ee-257,se=Hr[F];Ee=ze(l,o,(1<<se)-1)+Or[F],o+=se}var oe=d[bn(l,o)&Me],Te=oe>>>4;if(!oe)throw"invalid distance";o+=oe&15;var W=Ba[Te];if(Te>3){var se=_r[Te];W+=bn(l,o)&(1<<se)-1,o+=se}if(o>g){if(s)throw"unexpected EOF";break}r&&a(A+131072);for(var Ue=A+Ee;A<Ue;A+=4)e[A]=e[A-W],e[A+1]=e[A+1-W],e[A+2]=e[A+2-W],e[A+3]=e[A+3-W];A=Ue}}n.l=h,n.p=ge,n.b=A,h&&(c=1,n.m=B,n.d=d,n.n=m)}while(!c);return A==e.length?e:ga(e,0,A)},va=new Xe(0),Ma=function(l){if((l[0]&15)!=8||l[0]>>>4>7||(l[0]<<8|l[1])%31)throw"invalid zlib data";if(l[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function An(l,e){return Ea((Ma(l),l.subarray(2,-4)),e)}var Ia=typeof TextDecoder<"u"&&new TextDecoder,Fa=0;try{Ia.decode(va,{stream:!0}),Fa=1}catch{}const Ta=l=>l&&l.isCubeTexture;class Ra extends sn{constructor(e,n){var t,r;const s=Ta(e),c=((r=s?(t=e.image[0])==null?void 0:t.width:e.image.width)!=null?r:1024)/4,o=Math.floor(Math.log2(c)),A=Math.pow(2,o),h=3*Math.max(A,16*7),d=4*A,B=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/d}`,`#define CUBEUV_MAX_MIP ${o}.0`],m=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,g=B.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Yn>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,T={map:{value:e},height:{value:(n==null?void 0:n.height)||15},radius:{value:(n==null?void 0:n.radius)||100}},M=new ss(1,16),D=new tn({uniforms:T,fragmentShader:g,vertexShader:m,side:Kn});super(M,D)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var Da=Object.defineProperty,ba=(l,e,n)=>e in l?Da(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,ya=(l,e,n)=>(ba(l,e+"",n),n);class Ga{constructor(){ya(this,"_listeners")}addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[e]===void 0&&(t[e]=[]),t[e].indexOf(n)===-1&&t[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const t=this._listeners;return t[e]!==void 0&&t[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const r=t.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}var wa=Object.defineProperty,Sa=(l,e,n)=>e in l?wa(l,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):l[e]=n,j=(l,e,n)=>(Sa(l,typeof e!="symbol"?e+"":e,n),n);const hn=new as,Br=new is,Ha=Math.cos(70*(Math.PI/180)),pr=(l,e)=>(l%e+e)%e;let _a=class extends Ga{constructor(e,n){super(),j(this,"object"),j(this,"domElement"),j(this,"enabled",!0),j(this,"target",new Be),j(this,"minDistance",0),j(this,"maxDistance",1/0),j(this,"minZoom",0),j(this,"maxZoom",1/0),j(this,"minPolarAngle",0),j(this,"maxPolarAngle",Math.PI),j(this,"minAzimuthAngle",-1/0),j(this,"maxAzimuthAngle",1/0),j(this,"enableDamping",!1),j(this,"dampingFactor",.05),j(this,"enableZoom",!0),j(this,"zoomSpeed",1),j(this,"enableRotate",!0),j(this,"rotateSpeed",1),j(this,"enablePan",!0),j(this,"panSpeed",1),j(this,"screenSpacePanning",!0),j(this,"keyPanSpeed",7),j(this,"zoomToCursor",!1),j(this,"autoRotate",!1),j(this,"autoRotateSpeed",2),j(this,"reverseOrbit",!1),j(this,"reverseHorizontalOrbit",!1),j(this,"reverseVerticalOrbit",!1),j(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),j(this,"mouseButtons",{LEFT:xt.ROTATE,MIDDLE:xt.DOLLY,RIGHT:xt.PAN}),j(this,"touches",{ONE:Lt.ROTATE,TWO:Lt.DOLLY_PAN}),j(this,"target0"),j(this,"position0"),j(this,"zoom0"),j(this,"_domElementKeyEvents",null),j(this,"getPolarAngle"),j(this,"getAzimuthalAngle"),j(this,"setPolarAngle"),j(this,"setAzimuthalAngle"),j(this,"getDistance"),j(this,"getZoomScale"),j(this,"listenToKeyEvents"),j(this,"stopListenToKeyEvents"),j(this,"saveState"),j(this,"reset"),j(this,"update"),j(this,"connect"),j(this,"dispose"),j(this,"dollyIn"),j(this,"dollyOut"),j(this,"getScale"),j(this,"setScale"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>h.phi,this.getAzimuthalAngle=()=>h.theta,this.setPolarAngle=p=>{let y=pr(p,2*Math.PI),k=h.phi;k<0&&(k+=2*Math.PI),y<0&&(y+=2*Math.PI);let ie=Math.abs(y-k);2*Math.PI-ie<ie&&(y<k?y+=2*Math.PI:k+=2*Math.PI),d.phi=y-k,t.update()},this.setAzimuthalAngle=p=>{let y=pr(p,2*Math.PI),k=h.theta;k<0&&(k+=2*Math.PI),y<0&&(y+=2*Math.PI);let ie=Math.abs(y-k);2*Math.PI-ie<ie&&(y<k?y+=2*Math.PI:k+=2*Math.PI),d.theta=y-k,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=p=>{p.addEventListener("keydown",wt),this._domElementKeyEvents=p},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",wt),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(r),t.update(),o=c.NONE},this.update=(()=>{const p=new Be,y=new Be(0,1,0),k=new pn().setFromUnitVectors(e.up,y),ie=k.clone().invert(),w=new Be,He=new pn,qe=2*Math.PI;return function(){const ln=t.object.position;k.setFromUnitVectors(e.up,y),ie.copy(k).invert(),p.copy(ln).sub(t.target),p.applyQuaternion(k),h.setFromVector3(p),t.autoRotate&&o===c.NONE&&K($()),t.enableDamping?(h.theta+=d.theta*t.dampingFactor,h.phi+=d.phi*t.dampingFactor):(h.theta+=d.theta,h.phi+=d.phi);let We=t.minAzimuthAngle,Ve=t.maxAzimuthAngle;isFinite(We)&&isFinite(Ve)&&(We<-Math.PI?We+=qe:We>Math.PI&&(We-=qe),Ve<-Math.PI?Ve+=qe:Ve>Math.PI&&(Ve-=qe),We<=Ve?h.theta=Math.max(We,Math.min(Ve,h.theta)):h.theta=h.theta>(We+Ve)/2?Math.max(We,h.theta):Math.min(Ve,h.theta)),h.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,h.phi)),h.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(m,t.dampingFactor):t.target.add(m),t.zoomToCursor&&I||t.object.isOrthographicCamera?h.radius=oe(h.radius):h.radius=oe(h.radius*B),p.setFromSpherical(h),p.applyQuaternion(ie),ln.copy(t.target).add(p),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(d.theta*=1-t.dampingFactor,d.phi*=1-t.dampingFactor,m.multiplyScalar(1-t.dampingFactor)):(d.set(0,0,0),m.set(0,0,0));let Et=!1;if(t.zoomToCursor&&I){let vt=null;if(t.object instanceof Pt&&t.object.isPerspectiveCamera){const Mt=p.length();vt=oe(Mt*B);const _t=Mt-vt;t.object.position.addScaledVector(Z,_t),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const Mt=new Be(F.x,F.y,0);Mt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/B)),t.object.updateProjectionMatrix(),Et=!0;const _t=new Be(F.x,F.y,0);_t.unproject(t.object),t.object.position.sub(_t).add(Mt),t.object.updateMatrixWorld(),vt=p.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;vt!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(vt).add(t.object.position):(hn.origin.copy(t.object.position),hn.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(hn.direction))<Ha?e.lookAt(t.target):(Br.setFromNormalAndCoplanarPoint(t.object.up,t.target),hn.intersectPlane(Br,t.target))))}else t.object instanceof Rt&&t.object.isOrthographicCamera&&(Et=B!==1,Et&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/B)),t.object.updateProjectionMatrix()));return B=1,I=!1,Et||w.distanceToSquared(t.object.position)>A||8*(1-He.dot(t.object.quaternion))>A?(t.dispatchEvent(r),w.copy(t.object.position),He.copy(t.object.quaternion),Et=!1,!0):!1}})(),this.connect=p=>{t.domElement=p,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",cn),t.domElement.addEventListener("pointerdown",Gt),t.domElement.addEventListener("pointercancel",nt),t.domElement.addEventListener("wheel",Ne)},this.dispose=()=>{var p,y,k,ie,w,He;t.domElement&&(t.domElement.style.touchAction="auto"),(p=t.domElement)==null||p.removeEventListener("contextmenu",cn),(y=t.domElement)==null||y.removeEventListener("pointerdown",Gt),(k=t.domElement)==null||k.removeEventListener("pointercancel",nt),(ie=t.domElement)==null||ie.removeEventListener("wheel",Ne),(w=t.domElement)==null||w.ownerDocument.removeEventListener("pointermove",lt),(He=t.domElement)==null||He.ownerDocument.removeEventListener("pointerup",nt),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",wt)};const t=this,r={type:"change"},s={type:"start"},a={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=c.NONE;const A=1e-6,h=new ar,d=new ar;let B=1;const m=new Be,g=new xe,T=new xe,M=new xe,D=new xe,x=new xe,N=new xe,P=new xe,O=new xe,b=new xe,Z=new Be,F=new xe;let I=!1;const U=[],Y={};function $(){return 2*Math.PI/60/60*t.autoRotateSpeed}function z(){return Math.pow(.95,t.zoomSpeed)}function K(p){t.reverseOrbit||t.reverseHorizontalOrbit?d.theta+=p:d.theta-=p}function V(p){t.reverseOrbit||t.reverseVerticalOrbit?d.phi+=p:d.phi-=p}const W=(()=>{const p=new Be;return function(k,ie){p.setFromMatrixColumn(ie,0),p.multiplyScalar(-k),m.add(p)}})(),le=(()=>{const p=new Be;return function(k,ie){t.screenSpacePanning===!0?p.setFromMatrixColumn(ie,1):(p.setFromMatrixColumn(ie,0),p.crossVectors(t.object.up,p)),p.multiplyScalar(k),m.add(p)}})(),Me=(()=>{const p=new Be;return function(k,ie){const w=t.domElement;if(w&&t.object instanceof Pt&&t.object.isPerspectiveCamera){const He=t.object.position;p.copy(He).sub(t.target);let qe=p.length();qe*=Math.tan(t.object.fov/2*Math.PI/180),W(2*k*qe/w.clientHeight,t.object.matrix),le(2*ie*qe/w.clientHeight,t.object.matrix)}else w&&t.object instanceof Rt&&t.object.isOrthographicCamera?(W(k*(t.object.right-t.object.left)/t.object.zoom/w.clientWidth,t.object.matrix),le(ie*(t.object.top-t.object.bottom)/t.object.zoom/w.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function ge(p){t.object instanceof Pt&&t.object.isPerspectiveCamera||t.object instanceof Rt&&t.object.isOrthographicCamera?B=p:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function ee(p){ge(B/p)}function Ee(p){ge(B*p)}function se(p){if(!t.zoomToCursor||!t.domElement)return;I=!0;const y=t.domElement.getBoundingClientRect(),k=p.clientX-y.left,ie=p.clientY-y.top,w=y.width,He=y.height;F.x=k/w*2-1,F.y=-(ie/He)*2+1,Z.set(F.x,F.y,1).unproject(t.object).sub(t.object.position).normalize()}function oe(p){return Math.max(t.minDistance,Math.min(t.maxDistance,p))}function Te(p){g.set(p.clientX,p.clientY)}function Ue(p){se(p),P.set(p.clientX,p.clientY)}function ae(p){D.set(p.clientX,p.clientY)}function Le(p){T.set(p.clientX,p.clientY),M.subVectors(T,g).multiplyScalar(t.rotateSpeed);const y=t.domElement;y&&(K(2*Math.PI*M.x/y.clientHeight),V(2*Math.PI*M.y/y.clientHeight)),g.copy(T),t.update()}function Re(p){O.set(p.clientX,p.clientY),b.subVectors(O,P),b.y>0?ee(z()):b.y<0&&Ee(z()),P.copy(O),t.update()}function bt(p){x.set(p.clientX,p.clientY),N.subVectors(x,D).multiplyScalar(t.panSpeed),Me(N.x,N.y),D.copy(x),t.update()}function be(p){se(p),p.deltaY<0?Ee(z()):p.deltaY>0&&ee(z()),t.update()}function ce(p){let y=!1;switch(p.code){case t.keys.UP:Me(0,t.keyPanSpeed),y=!0;break;case t.keys.BOTTOM:Me(0,-t.keyPanSpeed),y=!0;break;case t.keys.LEFT:Me(t.keyPanSpeed,0),y=!0;break;case t.keys.RIGHT:Me(-t.keyPanSpeed,0),y=!0;break}y&&(p.preventDefault(),t.update())}function Pe(){if(U.length==1)g.set(U[0].pageX,U[0].pageY);else{const p=.5*(U[0].pageX+U[1].pageX),y=.5*(U[0].pageY+U[1].pageY);g.set(p,y)}}function Se(){if(U.length==1)D.set(U[0].pageX,U[0].pageY);else{const p=.5*(U[0].pageX+U[1].pageX),y=.5*(U[0].pageY+U[1].pageY);D.set(p,y)}}function Ze(){const p=U[0].pageX-U[1].pageX,y=U[0].pageY-U[1].pageY,k=Math.sqrt(p*p+y*y);P.set(0,k)}function tt(){t.enableZoom&&Ze(),t.enablePan&&Se()}function Kt(){t.enableZoom&&Ze(),t.enableRotate&&Pe()}function Je(p){if(U.length==1)T.set(p.pageX,p.pageY);else{const k=Ht(p),ie=.5*(p.pageX+k.x),w=.5*(p.pageY+k.y);T.set(ie,w)}M.subVectors(T,g).multiplyScalar(t.rotateSpeed);const y=t.domElement;y&&(K(2*Math.PI*M.x/y.clientHeight),V(2*Math.PI*M.y/y.clientHeight)),g.copy(T)}function mt(p){if(U.length==1)x.set(p.pageX,p.pageY);else{const y=Ht(p),k=.5*(p.pageX+y.x),ie=.5*(p.pageY+y.y);x.set(k,ie)}N.subVectors(x,D).multiplyScalar(t.panSpeed),Me(N.x,N.y),D.copy(x)}function ct(p){const y=Ht(p),k=p.pageX-y.x,ie=p.pageY-y.y,w=Math.sqrt(k*k+ie*ie);O.set(0,w),b.set(0,Math.pow(O.y/P.y,t.zoomSpeed)),ee(b.y),P.copy(O)}function yt(p){t.enableZoom&&ct(p),t.enablePan&&mt(p)}function Qt(p){t.enableZoom&&ct(p),t.enableRotate&&Je(p)}function Gt(p){var y,k;t.enabled!==!1&&(U.length===0&&((y=t.domElement)==null||y.ownerDocument.addEventListener("pointermove",lt),(k=t.domElement)==null||k.ownerDocument.addEventListener("pointerup",nt)),Fn(p),p.pointerType==="touch"?St(p):Ct(p))}function lt(p){t.enabled!==!1&&(p.pointerType==="touch"?In(p):Xt(p))}function nt(p){var y,k,ie;gt(p),U.length===0&&((y=t.domElement)==null||y.releasePointerCapture(p.pointerId),(k=t.domElement)==null||k.ownerDocument.removeEventListener("pointermove",lt),(ie=t.domElement)==null||ie.ownerDocument.removeEventListener("pointerup",nt)),t.dispatchEvent(a),o=c.NONE}function Ct(p){let y;switch(p.button){case 0:y=t.mouseButtons.LEFT;break;case 1:y=t.mouseButtons.MIDDLE;break;case 2:y=t.mouseButtons.RIGHT;break;default:y=-1}switch(y){case xt.DOLLY:if(t.enableZoom===!1)return;Ue(p),o=c.DOLLY;break;case xt.ROTATE:if(p.ctrlKey||p.metaKey||p.shiftKey){if(t.enablePan===!1)return;ae(p),o=c.PAN}else{if(t.enableRotate===!1)return;Te(p),o=c.ROTATE}break;case xt.PAN:if(p.ctrlKey||p.metaKey||p.shiftKey){if(t.enableRotate===!1)return;Te(p),o=c.ROTATE}else{if(t.enablePan===!1)return;ae(p),o=c.PAN}break;default:o=c.NONE}o!==c.NONE&&t.dispatchEvent(s)}function Xt(p){if(t.enabled!==!1)switch(o){case c.ROTATE:if(t.enableRotate===!1)return;Le(p);break;case c.DOLLY:if(t.enableZoom===!1)return;Re(p);break;case c.PAN:if(t.enablePan===!1)return;bt(p);break}}function Ne(p){t.enabled===!1||t.enableZoom===!1||o!==c.NONE&&o!==c.ROTATE||(p.preventDefault(),t.dispatchEvent(s),be(p),t.dispatchEvent(a))}function wt(p){t.enabled===!1||t.enablePan===!1||ce(p)}function St(p){switch(ye(p),U.length){case 1:switch(t.touches.ONE){case Lt.ROTATE:if(t.enableRotate===!1)return;Pe(),o=c.TOUCH_ROTATE;break;case Lt.PAN:if(t.enablePan===!1)return;Se(),o=c.TOUCH_PAN;break;default:o=c.NONE}break;case 2:switch(t.touches.TWO){case Lt.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;tt(),o=c.TOUCH_DOLLY_PAN;break;case Lt.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Kt(),o=c.TOUCH_DOLLY_ROTATE;break;default:o=c.NONE}break;default:o=c.NONE}o!==c.NONE&&t.dispatchEvent(s)}function In(p){switch(ye(p),o){case c.TOUCH_ROTATE:if(t.enableRotate===!1)return;Je(p),t.update();break;case c.TOUCH_PAN:if(t.enablePan===!1)return;mt(p),t.update();break;case c.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;yt(p),t.update();break;case c.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Qt(p),t.update();break;default:o=c.NONE}}function cn(p){t.enabled!==!1&&p.preventDefault()}function Fn(p){U.push(p)}function gt(p){delete Y[p.pointerId];for(let y=0;y<U.length;y++)if(U[y].pointerId==p.pointerId){U.splice(y,1);return}}function ye(p){let y=Y[p.pointerId];y===void 0&&(y=new xe,Y[p.pointerId]=y),y.set(p.pageX,p.pageY)}function Ht(p){const y=p.pointerId===U[0].pointerId?U[1]:U[0];return Y[y.pointerId]}this.dollyIn=(p=z())=>{Ee(p),t.update()},this.dollyOut=(p=z())=>{ee(p),t.update()},this.getScale=()=>B,this.setScale=p=>{ge(p),t.update()},this.getZoomScale=()=>z(),n!==void 0&&this.connect(n),this.update()}};function En(l){if(typeof TextDecoder<"u")return new TextDecoder().decode(l);let e="";for(let n=0,t=l.length;n<t;n++)e+=String.fromCharCode(l[n]);try{return decodeURIComponent(escape(e))}catch{return e}}const Tt="srgb",ot="srgb-linear",mr=3001,xa=3e3;class Zn extends Qn{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Ja(n)}),this.register(function(n){return new Na(n)}),this.register(function(n){return new Va(n)}),this.register(function(n){return new za(n)}),this.register(function(n){return new qa(n)}),this.register(function(n){return new Ka(n)}),this.register(function(n){return new Qa(n)}),this.register(function(n){return new Xa(n)}),this.register(function(n){return new ja(n)}),this.register(function(n){return new Pa(n)}),this.register(function(n){return new Ya(n)}),this.register(function(n){return new ka(n)}),this.register(function(n){return new Wa(n)}),this.register(function(n){return new Za(n)}),this.register(function(n){return new Oa(n)}),this.register(function(n){return new $a(n)}),this.register(function(n){return new ei(n)})}load(e,n,t,r){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const A=qt.extractUrlBase(e);a=qt.resolveURL(A,this.path)}else a=qt.extractUrlBase(e);this.manager.itemStart(e);const c=function(A){r?r(A):console.error(A),s.manager.itemError(e),s.manager.itemEnd(e)},o=new Bt(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(A){try{s.parse(A,a,function(h){n(h),s.manager.itemEnd(e)},c)}catch(h){c(h)}},t,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,t,r){let s;const a={},c={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(En(new Uint8Array(e.slice(0,4)))===Pr){try{a[ne.KHR_BINARY_GLTF]=new ti(e)}catch(h){r&&r(h);return}s=JSON.parse(a[ne.KHR_BINARY_GLTF].content)}else s=JSON.parse(En(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const o=new fi(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});o.fileLoader.setRequestHeader(this.requestHeader);for(let A=0;A<this.pluginCallbacks.length;A++){const h=this.pluginCallbacks[A](o);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),c[h.name]=h,a[h.name]=!0}if(s.extensionsUsed)for(let A=0;A<s.extensionsUsed.length;++A){const h=s.extensionsUsed[A],d=s.extensionsRequired||[];switch(h){case ne.KHR_MATERIALS_UNLIT:a[h]=new Ua;break;case ne.KHR_DRACO_MESH_COMPRESSION:a[h]=new ni(s,this.dracoLoader);break;case ne.KHR_TEXTURE_TRANSFORM:a[h]=new ri;break;case ne.KHR_MESH_QUANTIZATION:a[h]=new si;break;default:d.indexOf(h)>=0&&c[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}o.setExtensions(a),o.setPlugins(c),o.parse(t,r)}parseAsync(e,n){const t=this;return new Promise(function(r,s){t.parse(e,n,r,s)})}}function La(){let l={};return{get:function(e){return l[e]},add:function(e,n){l[e]=n},remove:function(e){delete l[e]},removeAll:function(){l={}}}}const ne={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Oa{constructor(e){this.parser=e,this.name=ne.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let t=0,r=n.length;t<r;t++){const s=n[t];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,t="light:"+e;let r=n.cache.get(t);if(r)return r;const s=n.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let A;const h=new pt(16777215);o.color!==void 0&&h.setRGB(o.color[0],o.color[1],o.color[2],ot);const d=o.range!==void 0?o.range:0;switch(o.type){case"directional":A=new ls(h),A.target.position.set(0,0,-1),A.add(A.target);break;case"point":A=new cs(h),A.distance=d;break;case"spot":A=new os(h),A.distance=d,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,A.angle=o.spot.outerConeAngle,A.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,A.target.position.set(0,0,-1),A.add(A.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return A.position.set(0,0,0),A.decay=2,st(A,o),o.intensity!==void 0&&(A.intensity=o.intensity),A.name=n.createUniqueName(o.name||"light_"+e),r=Promise.resolve(A),n.cache.add(t,r),r}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,t=this.parser,s=t.json.nodes[e],c=(s.extensions&&s.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(o){return t._getNodeRef(n.cache,c,o)})}}class Ua{constructor(){this.name=ne.KHR_MATERIALS_UNLIT}getMaterialType(){return Ot}extendParams(e,n,t){const r=[];e.color=new pt(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],ot),e.opacity=a[3]}s.baseColorTexture!==void 0&&r.push(t.assignTexture(e,"map",s.baseColorTexture,Tt))}return Promise.all(r)}}class Pa{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(n.emissiveIntensity=s),Promise.resolve()}}class Ja{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(n.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(t.assignTexture(n,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(t.assignTexture(n,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(t.assignTexture(n,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const c=a.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new xe(c,c)}return Promise.all(s)}}class Na{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class ka{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(n.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(t.assignTexture(n,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(n.iridescenceIOR=a.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(t.assignTexture(n,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class Ka{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new pt(0,0,0),n.sheenRoughness=0,n.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const c=a.sheenColorFactor;n.sheenColor.setRGB(c[0],c[1],c[2],ot)}return a.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(t.assignTexture(n,"sheenColorMap",a.sheenColorTexture,Tt)),a.sheenRoughnessTexture!==void 0&&s.push(t.assignTexture(n,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Qa{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(n.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(t.assignTexture(n,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class Xa{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];n.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(t.assignTexture(n,"thicknessMap",a.thicknessTexture)),n.attenuationDistance=a.attenuationDistance||1/0;const c=a.attenuationColor||[1,1,1];return n.attenuationColor=new pt().setRGB(c[0],c[1],c[2],ot),Promise.all(s)}}class ja{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Ya{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];n.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(t.assignTexture(n,"specularIntensityMap",a.specularTexture));const c=a.specularColorFactor||[1,1,1];return n.specularColor=new pt().setRGB(c[0],c[1],c[2],ot),a.specularColorTexture!==void 0&&s.push(t.assignTexture(n,"specularColorMap",a.specularColorTexture,Tt)),Promise.all(s)}}class Za{constructor(e){this.parser=e,this.name=ne.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return n.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(t.assignTexture(n,"bumpMap",a.bumpTexture)),Promise.all(s)}}class Wa{constructor(e){this.parser=e,this.name=ne.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return!t.extensions||!t.extensions[this.name]?null:et}extendMaterialParams(e,n){const t=this.parser,r=t.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(n.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(n.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(t.assignTexture(n,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class Va{constructor(e){this.parser=e,this.name=ne.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,t=n.json,r=t.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],a=n.options.ktx2Loader;if(!a){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,a)}}class za{constructor(e){this.parser=e,this.name=ne.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const a=s.extensions[n],c=r.images[a.source];let o=t.textureLoader;if(c.uri){const A=t.options.manager.getHandler(c.uri);A!==null&&(o=A)}return this.detectSupport().then(function(A){if(A)return t.loadTextureImage(e,a.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class qa{constructor(e){this.parser=e,this.name=ne.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,t=this.parser,r=t.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const a=s.extensions[n],c=r.images[a.source];let o=t.textureLoader;if(c.uri){const A=t.options.manager.getHandler(c.uri);A!==null&&(o=A)}return this.detectSupport().then(function(A){if(A)return t.loadTextureImage(e,a.source,o);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return t.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class $a{constructor(e){this.name=ne.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,t=n.bufferViews[e];if(t.extensions&&t.extensions[this.name]){const r=t.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(c){const o=r.byteOffset||0,A=r.byteLength||0,h=r.count,d=r.byteStride,B=new Uint8Array(c,o,A);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(h,d,B,r.mode,r.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(h*d);return a.decodeGltfBuffer(new Uint8Array(m),h,d,B,r.mode,r.filter),m})})}else return null}}class ei{constructor(e){this.name=ne.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,t=n.nodes[e];if(!t.extensions||!t.extensions[this.name]||t.mesh===void 0)return null;const r=n.meshes[t.mesh];for(const A of r.primitives)if(A.mode!==Qe.TRIANGLES&&A.mode!==Qe.TRIANGLE_STRIP&&A.mode!==Qe.TRIANGLE_FAN&&A.mode!==void 0)return null;const a=t.extensions[this.name].attributes,c=[],o={};for(const A in a)c.push(this.parser.getDependency("accessor",a[A]).then(h=>(o[A]=h,o[A])));return c.length<1?null:(c.push(this.parser.createNodeMesh(e)),Promise.all(c).then(A=>{const h=A.pop(),d=h.isGroup?h.children:[h],B=A[0].count,m=[];for(const g of d){const T=new mn,M=new Be,D=new pn,x=new Be(1,1,1),N=new us(g.geometry,g.material,B);for(let P=0;P<B;P++)o.TRANSLATION&&M.fromBufferAttribute(o.TRANSLATION,P),o.ROTATION&&D.fromBufferAttribute(o.ROTATION,P),o.SCALE&&x.fromBufferAttribute(o.SCALE,P),N.setMatrixAt(P,T.compose(M,D,x));for(const P in o)if(P==="_COLOR_0"){const O=o[P];N.instanceColor=new As(O.array,O.itemSize,O.normalized)}else P!=="TRANSLATION"&&P!=="ROTATION"&&P!=="SCALE"&&g.geometry.setAttribute(P,o[P]);Fr.prototype.copy.call(N,g),this.parser.assignFinalMaterial(N),m.push(N)}return h.isGroup?(h.clear(),h.add(...m),h):m[0]}))}}const Pr="glTF",Wt=12,Cr={JSON:1313821514,BIN:5130562};class ti{constructor(e){this.name=ne.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Wt);if(this.header={magic:En(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Pr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const t=this.header.length-Wt,r=new DataView(e,Wt);let s=0;for(;s<t;){const a=r.getUint32(s,!0);s+=4;const c=r.getUint32(s,!0);if(s+=4,c===Cr.JSON){const o=new Uint8Array(e,Wt+s,a);this.content=En(o)}else if(c===Cr.BIN){const o=Wt+s;this.body=e.slice(o,o+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ni{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ne.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const t=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,c={},o={},A={};for(const h in a){const d=Nn[h]||h.toLowerCase();c[d]=a[h]}for(const h in e.attributes){const d=Nn[h]||h.toLowerCase();if(a[h]!==void 0){const B=t.accessors[e.attributes[h]],m=Jt[B.componentType];A[d]=m.name,o[d]=B.normalized===!0}}return n.getDependency("bufferView",s).then(function(h){return new Promise(function(d,B){r.decodeDracoFile(h,function(m){for(const g in m.attributes){const T=m.attributes[g],M=o[g];M!==void 0&&(T.normalized=M)}d(m)},c,A,ot,B)})})}}class ri{constructor(){this.name=ne.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class si{constructor(){this.name=ne.KHR_MESH_QUANTIZATION}}class Jr extends Os{constructor(e,n,t,r){super(e,n,t,r)}copySampleValue_(e){const n=this.resultBuffer,t=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let a=0;a!==r;a++)n[a]=t[s+a];return n}interpolate_(e,n,t,r){const s=this.resultBuffer,a=this.sampleValues,c=this.valueSize,o=c*2,A=c*3,h=r-n,d=(t-n)/h,B=d*d,m=B*d,g=e*A,T=g-A,M=-2*m+3*B,D=m-B,x=1-M,N=D-B+d;for(let P=0;P!==c;P++){const O=a[T+P+c],b=a[T+P+o]*h,Z=a[g+P+c],F=a[g+P]*h;s[P]=x*O+N*b+M*Z+D*F}return s}}const ai=new pn;class ii extends Jr{interpolate_(e,n,t,r){const s=super.interpolate_(e,n,t,r);return ai.fromArray(s).normalize().toArray(s),s}}const Qe={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Jt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},gr={9728:Ds,9729:je,9984:bs,9985:ys,9986:Gs,9987:Tr},Er={33071:at,33648:ws,10497:xn},yn={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...Yn>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ht={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},oi={CUBICSPLINE:void 0,LINEAR:br,STEP:Ss},Gn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ci(l){return l.DefaultMaterial===void 0&&(l.DefaultMaterial=new Rr({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Hs})),l.DefaultMaterial}function Ft(l,e,n){for(const t in n.extensions)l[t]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[t]=n.extensions[t])}function st(l,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(l.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function li(l,e,n){let t=!1,r=!1,s=!1;for(let A=0,h=e.length;A<h;A++){const d=e[A];if(d.POSITION!==void 0&&(t=!0),d.NORMAL!==void 0&&(r=!0),d.COLOR_0!==void 0&&(s=!0),t&&r&&s)break}if(!t&&!r&&!s)return Promise.resolve(l);const a=[],c=[],o=[];for(let A=0,h=e.length;A<h;A++){const d=e[A];if(t){const B=d.POSITION!==void 0?n.getDependency("accessor",d.POSITION):l.attributes.position;a.push(B)}if(r){const B=d.NORMAL!==void 0?n.getDependency("accessor",d.NORMAL):l.attributes.normal;c.push(B)}if(s){const B=d.COLOR_0!==void 0?n.getDependency("accessor",d.COLOR_0):l.attributes.color;o.push(B)}}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(o)]).then(function(A){const h=A[0],d=A[1],B=A[2];return t&&(l.morphAttributes.position=h),r&&(l.morphAttributes.normal=d),s&&(l.morphAttributes.color=B),l.morphTargetsRelative=!0,l})}function ui(l,e){if(l.updateMorphTargets(),e.weights!==void 0)for(let n=0,t=e.weights.length;n<t;n++)l.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(l.morphTargetInfluences.length===n.length){l.morphTargetDictionary={};for(let t=0,r=n.length;t<r;t++)l.morphTargetDictionary[n[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ai(l){let e;const n=l.extensions&&l.extensions[ne.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+wn(n.attributes):e=l.indices+":"+wn(l.attributes)+":"+l.mode,l.targets!==void 0)for(let t=0,r=l.targets.length;t<r;t++)e+=":"+wn(l.targets[t]);return e}function wn(l){let e="";const n=Object.keys(l).sort();for(let t=0,r=n.length;t<r;t++)e+=n[t]+":"+l[n[t]]+";";return e}function kn(l){switch(l){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function hi(l){return l.search(/\.jpe?g($|\?)/i)>0||l.search(/^data\:image\/jpeg/)===0?"image/jpeg":l.search(/\.webp($|\?)/i)>0||l.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const di=new mn;class fi{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new La,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let t=!1,r=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(t=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||t||r&&s<98?this.textureLoader=new hs(this.options.manager):this.textureLoader=new ds(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Bt(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const t=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([t.getDependencies("scene"),t.getDependencies("animation"),t.getDependencies("camera")])}).then(function(a){const c={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:t,userData:{}};return Ft(s,c,r),st(c,r),Promise.all(t._invokeAll(function(o){return o.afterRoot&&o.afterRoot(c)})).then(function(){for(const o of c.scenes)o.updateMatrixWorld();e(c)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],t=this.json.meshes||[];for(let r=0,s=n.length;r<s;r++){const a=n[r].joints;for(let c=0,o=a.length;c<o;c++)e[a[c]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(t[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,t){if(e.refs[n]<=1)return t;const r=t.clone(),s=(a,c)=>{const o=this.associations.get(a);o!=null&&this.associations.set(c,o);for(const[A,h]of a.children.entries())s(h,c.children[A])};return s(t,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let t=0;t<n.length;t++){const r=e(n[t]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const t=[];for(let r=0;r<n.length;r++){const s=e(n[r]);s&&t.push(s)}return t}getDependency(e,n){const t=e+":"+n;let r=this.cache.get(t);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":r=this.loadCamera(n);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(t,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const t=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(s,a){return t.getDependency(e,a)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],t=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[ne.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,a){t.load(qt.resolveURL(n.uri,r.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(t){const r=n.byteLength||0,s=n.byteOffset||0;return t.slice(s,s+r)})}loadAccessor(e){const n=this,t=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=yn[r.type],c=Jt[r.componentType],o=r.normalized===!0,A=new c(r.count*a);return Promise.resolve(new $t(A,a,o))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(a){const c=a[0],o=yn[r.type],A=Jt[r.componentType],h=A.BYTES_PER_ELEMENT,d=h*o,B=r.byteOffset||0,m=r.bufferView!==void 0?t.bufferViews[r.bufferView].byteStride:void 0,g=r.normalized===!0;let T,M;if(m&&m!==d){const D=Math.floor(B/m),x="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+D+":"+r.count;let N=n.cache.get(x);N||(T=new A(c,D*m,r.count*m/h),N=new fs(T,m/h),n.cache.add(x,N)),M=new _s(N,o,B%m/h,g)}else c===null?T=new A(r.count*o):T=new A(c,B,r.count*o),M=new $t(T,o,g);if(r.sparse!==void 0){const D=yn.SCALAR,x=Jt[r.sparse.indices.componentType],N=r.sparse.indices.byteOffset||0,P=r.sparse.values.byteOffset||0,O=new x(a[1],N,r.sparse.count*D),b=new A(a[2],P,r.sparse.count*o);c!==null&&(M=new $t(M.array.slice(),M.itemSize,M.normalized));for(let Z=0,F=O.length;Z<F;Z++){const I=O[Z];if(M.setX(I,b[Z*o]),o>=2&&M.setY(I,b[Z*o+1]),o>=3&&M.setZ(I,b[Z*o+2]),o>=4&&M.setW(I,b[Z*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(e){const n=this.json,t=this.options,s=n.textures[e].source,a=n.images[s];let c=this.textureLoader;if(a.uri){const o=t.manager.getHandler(a.uri);o!==null&&(c=o)}return this.loadTextureImage(e,s,c)}loadTextureImage(e,n,t){const r=this,s=this.json,a=s.textures[e],c=s.images[n],o=(c.uri||c.bufferView)+":"+a.sampler;if(this.textureCache[o])return this.textureCache[o];const A=this.loadImageSource(n,t).then(function(h){h.flipY=!1,h.name=a.name||c.name||"",h.name===""&&typeof c.uri=="string"&&c.uri.startsWith("data:image/")===!1&&(h.name=c.uri);const B=(s.samplers||{})[a.sampler]||{};return h.magFilter=gr[B.magFilter]||je,h.minFilter=gr[B.minFilter]||Tr,h.wrapS=Er[B.wrapS]||xn,h.wrapT=Er[B.wrapT]||xn,r.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[o]=A,A}loadImageSource(e,n){const t=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(d=>d.clone());const a=r.images[e],c=self.URL||self.webkitURL;let o=a.uri||"",A=!1;if(a.bufferView!==void 0)o=t.getDependency("bufferView",a.bufferView).then(function(d){A=!0;const B=new Blob([d],{type:a.mimeType});return o=c.createObjectURL(B),o});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(o).then(function(d){return new Promise(function(B,m){let g=B;n.isImageBitmapLoader===!0&&(g=function(T){const M=new dt(T);M.needsUpdate=!0,B(M)}),n.load(qt.resolveURL(d,s.path),g,void 0,m)})}).then(function(d){return A===!0&&c.revokeObjectURL(o),st(d,a),d.userData.mimeType=a.mimeType||hi(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),d});return this.sourceCache[e]=h,h}assignTexture(e,n,t,r){const s=this;return this.getDependency("texture",t.index).then(function(a){if(!a)return null;if(t.texCoord!==void 0&&t.texCoord>0&&(a=a.clone(),a.channel=t.texCoord),s.extensions[ne.KHR_TEXTURE_TRANSFORM]){const c=t.extensions!==void 0?t.extensions[ne.KHR_TEXTURE_TRANSFORM]:void 0;if(c){const o=s.associations.get(a);a=s.extensions[ne.KHR_TEXTURE_TRANSFORM].extendTexture(a,c),s.associations.set(a,o)}}return r!==void 0&&(typeof r=="number"&&(r=r===mr?Tt:ot),"colorSpace"in a?a.colorSpace=r:a.encoding=r===Tt?mr:xa),e[n]=a,a})}assignFinalMaterial(e){const n=e.geometry;let t=e.material;const r=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,a=n.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+t.uuid;let o=this.cache.get(c);o||(o=new Bs,Tn.prototype.copy.call(o,t),o.color.copy(t.color),o.map=t.map,o.sizeAttenuation=!1,this.cache.add(c,o)),t=o}else if(e.isLine){const c="LineBasicMaterial:"+t.uuid;let o=this.cache.get(c);o||(o=new ps,Tn.prototype.copy.call(o,t),o.color.copy(t.color),o.map=t.map,this.cache.add(c,o)),t=o}if(r||s||a){let c="ClonedMaterial:"+t.uuid+":";r&&(c+="derivative-tangents:"),s&&(c+="vertex-colors:"),a&&(c+="flat-shading:");let o=this.cache.get(c);o||(o=t.clone(),s&&(o.vertexColors=!0),a&&(o.flatShading=!0),r&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(c,o),this.associations.set(o,this.associations.get(t))),t=o}e.material=t}getMaterialType(){return Rr}loadMaterial(e){const n=this,t=this.json,r=this.extensions,s=t.materials[e];let a;const c={},o=s.extensions||{},A=[];if(o[ne.KHR_MATERIALS_UNLIT]){const d=r[ne.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),A.push(d.extendParams(c,s,n))}else{const d=s.pbrMetallicRoughness||{};if(c.color=new pt(1,1,1),c.opacity=1,Array.isArray(d.baseColorFactor)){const B=d.baseColorFactor;c.color.setRGB(B[0],B[1],B[2],ot),c.opacity=B[3]}d.baseColorTexture!==void 0&&A.push(n.assignTexture(c,"map",d.baseColorTexture,Tt)),c.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,c.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(A.push(n.assignTexture(c,"metalnessMap",d.metallicRoughnessTexture)),A.push(n.assignTexture(c,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(B){return B.getMaterialType&&B.getMaterialType(e)}),A.push(Promise.all(this._invokeAll(function(B){return B.extendMaterialParams&&B.extendMaterialParams(e,c)})))}s.doubleSided===!0&&(c.side=Kn);const h=s.alphaMode||Gn.OPAQUE;if(h===Gn.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,h===Gn.MASK&&(c.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==Ot&&(A.push(n.assignTexture(c,"normalMap",s.normalTexture)),c.normalScale=new xe(1,1),s.normalTexture.scale!==void 0)){const d=s.normalTexture.scale;c.normalScale.set(d,d)}if(s.occlusionTexture!==void 0&&a!==Ot&&(A.push(n.assignTexture(c,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==Ot){const d=s.emissiveFactor;c.emissive=new pt().setRGB(d[0],d[1],d[2],ot)}return s.emissiveTexture!==void 0&&a!==Ot&&A.push(n.assignTexture(c,"emissiveMap",s.emissiveTexture,Tt)),Promise.all(A).then(function(){const d=new a(c);return s.name&&(d.name=s.name),st(d,s),n.associations.set(d,{materials:e}),s.extensions&&Ft(r,d,s),d})}createUniqueName(e){const n=ms.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,t=this.extensions,r=this.primitiveCache;function s(c){return t[ne.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(function(o){return vr(o,c,n)})}const a=[];for(let c=0,o=e.length;c<o;c++){const A=e[c],h=Ai(A),d=r[h];if(d)a.push(d.promise);else{let B;A.extensions&&A.extensions[ne.KHR_DRACO_MESH_COMPRESSION]?B=s(A):B=vr(new Dr,A,n),r[h]={primitive:A,promise:B},a.push(B)}}return Promise.all(a)}loadMesh(e){const n=this,t=this.json,r=this.extensions,s=t.meshes[e],a=s.primitives,c=[];for(let o=0,A=a.length;o<A;o++){const h=a[o].material===void 0?ci(this.cache):this.getDependency("material",a[o].material);c.push(h)}return c.push(n.loadGeometries(a)),Promise.all(c).then(function(o){const A=o.slice(0,o.length-1),h=o[o.length-1],d=[];for(let m=0,g=h.length;m<g;m++){const T=h[m],M=a[m];let D;const x=A[m];if(M.mode===Qe.TRIANGLES||M.mode===Qe.TRIANGLE_STRIP||M.mode===Qe.TRIANGLE_FAN||M.mode===void 0)D=s.isSkinnedMesh===!0?new Cs(T,x):new sn(T,x),D.isSkinnedMesh===!0&&D.normalizeSkinWeights(),M.mode===Qe.TRIANGLE_STRIP?D.geometry=fr(D.geometry,Ir):M.mode===Qe.TRIANGLE_FAN&&(D.geometry=fr(D.geometry,_n));else if(M.mode===Qe.LINES)D=new gs(T,x);else if(M.mode===Qe.LINE_STRIP)D=new Es(T,x);else if(M.mode===Qe.LINE_LOOP)D=new vs(T,x);else if(M.mode===Qe.POINTS)D=new Ms(T,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(D.geometry.morphAttributes).length>0&&ui(D,s),D.name=n.createUniqueName(s.name||"mesh_"+e),st(D,s),M.extensions&&Ft(r,D,M),n.assignFinalMaterial(D),d.push(D)}for(let m=0,g=d.length;m<g;m++)n.associations.set(d[m],{meshes:e,primitives:m});if(d.length===1)return s.extensions&&Ft(r,d[0],s),d[0];const B=new Rn;s.extensions&&Ft(r,B,s),n.associations.set(B,{meshes:e});for(let m=0,g=d.length;m<g;m++)B.add(d[m]);return B})}loadCamera(e){let n;const t=this.json.cameras[e],r=t[t.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return t.type==="perspective"?n=new Pt(Is.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):t.type==="orthographic"&&(n=new Rt(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),t.name&&(n.name=this.createUniqueName(t.name)),st(n,t),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],t=[];for(let r=0,s=n.joints.length;r<s;r++)t.push(this._loadNodeShallow(n.joints[r]));return n.inverseBindMatrices!==void 0?t.push(this.getDependency("accessor",n.inverseBindMatrices)):t.push(null),Promise.all(t).then(function(r){const s=r.pop(),a=r,c=[],o=[];for(let A=0,h=a.length;A<h;A++){const d=a[A];if(d){c.push(d);const B=new mn;s!==null&&B.fromArray(s.array,A*16),o.push(B)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[A])}return new Fs(c,o)})}loadAnimation(e){const n=this.json,t=this,r=n.animations[e],s=r.name?r.name:"animation_"+e,a=[],c=[],o=[],A=[],h=[];for(let d=0,B=r.channels.length;d<B;d++){const m=r.channels[d],g=r.samplers[m.sampler],T=m.target,M=T.node,D=r.parameters!==void 0?r.parameters[g.input]:g.input,x=r.parameters!==void 0?r.parameters[g.output]:g.output;T.node!==void 0&&(a.push(this.getDependency("node",M)),c.push(this.getDependency("accessor",D)),o.push(this.getDependency("accessor",x)),A.push(g),h.push(T))}return Promise.all([Promise.all(a),Promise.all(c),Promise.all(o),Promise.all(A),Promise.all(h)]).then(function(d){const B=d[0],m=d[1],g=d[2],T=d[3],M=d[4],D=[];for(let x=0,N=B.length;x<N;x++){const P=B[x],O=m[x],b=g[x],Z=T[x],F=M[x];if(P===void 0)continue;P.updateMatrix&&P.updateMatrix();const I=t._createAnimationTracks(P,O,b,Z,F);if(I)for(let U=0;U<I.length;U++)D.push(I[U])}return new Ts(s,void 0,D)})}createNodeMesh(e){const n=this.json,t=this,r=n.nodes[e];return r.mesh===void 0?null:t.getDependency("mesh",r.mesh).then(function(s){const a=t._getNodeRef(t.meshCache,r.mesh,s);return r.weights!==void 0&&a.traverse(function(c){if(c.isMesh)for(let o=0,A=r.weights.length;o<A;o++)c.morphTargetInfluences[o]=r.weights[o]}),a})}loadNode(e){const n=this.json,t=this,r=n.nodes[e],s=t._loadNodeShallow(e),a=[],c=r.children||[];for(let A=0,h=c.length;A<h;A++)a.push(t.getDependency("node",c[A]));const o=r.skin===void 0?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),o]).then(function(A){const h=A[0],d=A[1],B=A[2];B!==null&&h.traverse(function(m){m.isSkinnedMesh&&m.bind(B,di)});for(let m=0,g=d.length;m<g;m++)h.add(d[m]);return h})}_loadNodeShallow(e){const n=this.json,t=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=n.nodes[e],a=s.name?r.createUniqueName(s.name):"",c=[],o=r._invokeOne(function(A){return A.createNodeMesh&&A.createNodeMesh(e)});return o&&c.push(o),s.camera!==void 0&&c.push(r.getDependency("camera",s.camera).then(function(A){return r._getNodeRef(r.cameraCache,s.camera,A)})),r._invokeAll(function(A){return A.createNodeAttachment&&A.createNodeAttachment(e)}).forEach(function(A){c.push(A)}),this.nodeCache[e]=Promise.all(c).then(function(A){let h;if(s.isBone===!0?h=new Rs:A.length>1?h=new Rn:A.length===1?h=A[0]:h=new Fr,h!==A[0])for(let d=0,B=A.length;d<B;d++)h.add(A[d]);if(s.name&&(h.userData.name=s.name,h.name=a),st(h,s),s.extensions&&Ft(t,h,s),s.matrix!==void 0){const d=new mn;d.fromArray(s.matrix),h.applyMatrix4(d)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return r.associations.has(h)||r.associations.set(h,{}),r.associations.get(h).nodes=e,h}),this.nodeCache[e]}loadScene(e){const n=this.extensions,t=this.json.scenes[e],r=this,s=new Rn;t.name&&(s.name=r.createUniqueName(t.name)),st(s,t),t.extensions&&Ft(n,s,t);const a=t.nodes||[],c=[];for(let o=0,A=a.length;o<A;o++)c.push(r.getDependency("node",a[o]));return Promise.all(c).then(function(o){for(let h=0,d=o.length;h<d;h++)s.add(o[h]);const A=h=>{const d=new Map;for(const[B,m]of r.associations)(B instanceof Tn||B instanceof dt)&&d.set(B,m);return h.traverse(B=>{const m=r.associations.get(B);m!=null&&d.set(B,m)}),d};return r.associations=A(s),s})}_createAnimationTracks(e,n,t,r,s){const a=[],c=e.name?e.name:e.uuid,o=[];ht[s.path]===ht.weights?e.traverse(function(B){B.morphTargetInfluences&&o.push(B.name?B.name:B.uuid)}):o.push(c);let A;switch(ht[s.path]){case ht.weights:A=or;break;case ht.rotation:A=cr;break;case ht.position:case ht.scale:A=ir;break;default:switch(t.itemSize){case 1:A=or;break;case 2:case 3:default:A=ir;break}break}const h=r.interpolation!==void 0?oi[r.interpolation]:br,d=this._getArrayFromAccessor(t);for(let B=0,m=o.length;B<m;B++){const g=new A(o[B]+"."+ht[s.path],n.array,d,h);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(e){let n=e.array;if(e.normalized){const t=kn(n.constructor),r=new Float32Array(n.length);for(let s=0,a=n.length;s<a;s++)r[s]=n[s]*t;n=r}return n}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(t){const r=this instanceof cr?ii:Jr;return new r(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Bi(l,e,n){const t=e.attributes,r=new xs;if(t.POSITION!==void 0){const c=n.json.accessors[t.POSITION],o=c.min,A=c.max;if(o!==void 0&&A!==void 0){if(r.set(new Be(o[0],o[1],o[2]),new Be(A[0],A[1],A[2])),c.normalized){const h=kn(Jt[c.componentType]);r.min.multiplyScalar(h),r.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const c=new Be,o=new Be;for(let A=0,h=s.length;A<h;A++){const d=s[A];if(d.POSITION!==void 0){const B=n.json.accessors[d.POSITION],m=B.min,g=B.max;if(m!==void 0&&g!==void 0){if(o.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),o.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),o.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),B.normalized){const T=kn(Jt[B.componentType]);o.multiplyScalar(T)}c.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}l.boundingBox=r;const a=new Ls;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,l.boundingSphere=a}function vr(l,e,n){const t=e.attributes,r=[];function s(a,c){return n.getDependency("accessor",a).then(function(o){l.setAttribute(c,o)})}for(const a in t){const c=Nn[a]||a.toLowerCase();c in l.attributes||r.push(s(t[a],c))}if(e.indices!==void 0&&!l.index){const a=n.getDependency("accessor",e.indices).then(function(c){l.setIndex(c)});r.push(a)}return st(l,e),Bi(l,e,n),Promise.all(r).then(function(){return e.targets!==void 0?li(l,e.targets,n):l})}const pi={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},mi={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class Ci extends yr{constructor(e){super(e),this.type=Ye}parse(e){const a=function(F,I){switch(F){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},h=`
`,d=function(F,I,U){I=I||1024;let $=F.pos,z=-1,K=0,V="",W=String.fromCharCode.apply(null,new Uint16Array(F.subarray($,$+128)));for(;0>(z=W.indexOf(h))&&K<I&&$<F.byteLength;)V+=W,K+=W.length,$+=128,W+=String.fromCharCode.apply(null,new Uint16Array(F.subarray($,$+128)));return-1<z?(F.pos+=K+z+1,V+W.slice(0,z)):!1},B=function(F){const I=/^#\?(\S+)/,U=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Y=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,$=/^\s*FORMAT=(\S+)\s*$/,z=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,K={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let V,W;for((F.pos>=F.byteLength||!(V=d(F)))&&a(1,"no header found"),(W=V.match(I))||a(3,"bad initial token"),K.valid|=1,K.programtype=W[1],K.string+=V+`
`;V=d(F),V!==!1;){if(K.string+=V+`
`,V.charAt(0)==="#"){K.comments+=V+`
`;continue}if((W=V.match(U))&&(K.gamma=parseFloat(W[1])),(W=V.match(Y))&&(K.exposure=parseFloat(W[1])),(W=V.match($))&&(K.valid|=2,K.format=W[1]),(W=V.match(z))&&(K.valid|=4,K.height=parseInt(W[1],10),K.width=parseInt(W[2],10)),K.valid&2&&K.valid&4)break}return K.valid&2||a(3,"missing format specifier"),K.valid&4||a(3,"missing image size specifier"),K},m=function(F,I,U){const Y=I;if(Y<8||Y>32767||F[0]!==2||F[1]!==2||F[2]&128)return new Uint8Array(F);Y!==(F[2]<<8|F[3])&&a(3,"wrong scanline width");const $=new Uint8Array(4*I*U);$.length||a(4,"unable to allocate buffer space");let z=0,K=0;const V=4*Y,W=new Uint8Array(4),le=new Uint8Array(V);let Me=U;for(;Me>0&&K<F.byteLength;){K+4>F.byteLength&&a(1),W[0]=F[K++],W[1]=F[K++],W[2]=F[K++],W[3]=F[K++],(W[0]!=2||W[1]!=2||(W[2]<<8|W[3])!=Y)&&a(3,"bad rgbe scanline format");let ge=0,ee;for(;ge<V&&K<F.byteLength;){ee=F[K++];const se=ee>128;if(se&&(ee-=128),(ee===0||ge+ee>V)&&a(3,"bad scanline data"),se){const oe=F[K++];for(let Te=0;Te<ee;Te++)le[ge++]=oe}else le.set(F.subarray(K,K+ee),ge),ge+=ee,K+=ee}const Ee=Y;for(let se=0;se<Ee;se++){let oe=0;$[z]=le[se+oe],oe+=Y,$[z+1]=le[se+oe],oe+=Y,$[z+2]=le[se+oe],oe+=Y,$[z+3]=le[se+oe],z+=4}Me--}return $},g=function(F,I,U,Y){const $=F[I+3],z=Math.pow(2,$-128)/255;U[Y+0]=F[I+0]*z,U[Y+1]=F[I+1]*z,U[Y+2]=F[I+2]*z,U[Y+3]=1},T=function(F,I,U,Y){const $=F[I+3],z=Math.pow(2,$-128)/255;U[Y+0]=Ut.toHalfFloat(Math.min(F[I+0]*z,65504)),U[Y+1]=Ut.toHalfFloat(Math.min(F[I+1]*z,65504)),U[Y+2]=Ut.toHalfFloat(Math.min(F[I+2]*z,65504)),U[Y+3]=Ut.toHalfFloat(1)},M=new Uint8Array(e);M.pos=0;const D=B(M),x=D.width,N=D.height,P=m(M.subarray(M.pos),x,N);let O,b,Z;switch(this.type){case it:Z=P.length/4;const F=new Float32Array(Z*4);for(let U=0;U<Z;U++)g(P,U*4,F,U*4);O=F,b=it;break;case Ye:Z=P.length/4;const I=new Uint16Array(Z*4);for(let U=0;U<Z;U++)T(P,U*4,I,U*4);O=I,b=Ye;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:x,height:N,data:O,header:D.string,gamma:D.gamma,exposure:D.exposure,type:b}}setDataType(e){return this.type=e,this}load(e,n,t,r){function s(a,c){switch(a.type){case it:case Ye:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=je,a.magFilter=je,a.generateMipmaps=!1,a.flipY=!0;break}n&&n(a,c)}return super.load(e,s,t,r)}}const Vt=Yn>=152;class gi extends yr{constructor(e){super(e),this.type=Ye}parse(e){const I=Math.pow(2.7182818,2.2);function U(i,u){for(var f=0,C=0;C<65536;++C)(C==0||i[C>>3]&1<<(C&7))&&(u[f++]=C);for(var E=f-1;f<65536;)u[f++]=0;return E}function Y(i){for(var u=0;u<16384;u++)i[u]={},i[u].len=0,i[u].lit=0,i[u].p=null}const $={l:0,c:0,lc:0};function z(i,u,f,C,E){for(;f<i;)u=u<<8|Ht(C,E),f+=8;f-=i,$.l=u>>f&(1<<i)-1,$.c=u,$.lc=f}const K=new Array(59);function V(i){for(var u=0;u<=58;++u)K[u]=0;for(var u=0;u<65537;++u)K[i[u]]+=1;for(var f=0,u=58;u>0;--u){var C=f+K[u]>>1;K[u]=f,f=C}for(var u=0;u<65537;++u){var E=i[u];E>0&&(i[u]=E|K[E]++<<6)}}function W(i,u,f,C,E,v,G){for(var R=f,_=0,H=0;E<=v;E++){if(R.value-f.value>C)return!1;z(6,_,H,i,R);var L=$.l;if(_=$.c,H=$.lc,G[E]=L,L==63){if(R.value-f.value>C)throw"Something wrong with hufUnpackEncTable";z(8,_,H,i,R);var S=$.l+6;if(_=$.c,H=$.lc,E+S>v+1)throw"Something wrong with hufUnpackEncTable";for(;S--;)G[E++]=0;E--}else if(L>=59){var S=L-59+2;if(E+S>v+1)throw"Something wrong with hufUnpackEncTable";for(;S--;)G[E++]=0;E--}}V(G)}function le(i){return i&63}function Me(i){return i>>6}function ge(i,u,f,C){for(;u<=f;u++){var E=Me(i[u]),v=le(i[u]);if(E>>v)throw"Invalid table entry";if(v>14){var G=C[E>>v-14];if(G.len)throw"Invalid table entry";if(G.lit++,G.p){var R=G.p;G.p=new Array(G.lit);for(var _=0;_<G.lit-1;++_)G.p[_]=R[_]}else G.p=new Array(1);G.p[G.lit-1]=u}else if(v)for(var H=0,_=1<<14-v;_>0;_--){var G=C[(E<<14-v)+H];if(G.len||G.p)throw"Invalid table entry";G.len=v,G.lit=u,H++}}return!0}const ee={c:0,lc:0};function Ee(i,u,f,C){i=i<<8|Ht(f,C),u+=8,ee.c=i,ee.lc=u}const se={c:0,lc:0};function oe(i,u,f,C,E,v,G,R,_,H){if(i==u){C<8&&(Ee(f,C,E,G),f=ee.c,C=ee.lc),C-=8;var L=f>>C,L=new Uint8Array([L])[0];if(_.value+L>H)return!1;for(var S=R[_.value-1];L-- >0;)R[_.value++]=S}else if(_.value<H)R[_.value++]=i;else return!1;se.c=f,se.lc=C}function Te(i){return i&65535}function Ue(i){var u=Te(i);return u>32767?u-65536:u}const ae={a:0,b:0};function Le(i,u){var f=Ue(i),C=Ue(u),E=C,v=f+(E&1)+(E>>1),G=v,R=v-E;ae.a=G,ae.b=R}function Re(i,u){var f=Te(i),C=Te(u),E=f-(C>>1)&65535,v=C+E-32768&65535;ae.a=v,ae.b=E}function bt(i,u,f,C,E,v,G){for(var R=G<16384,_=f>E?E:f,H=1,L;H<=_;)H<<=1;for(H>>=1,L=H,H>>=1;H>=1;){for(var S=0,ve=S+v*(E-L),Q=v*H,X=v*L,q=C*H,te=C*L,Ae,de,Fe,_e;S<=ve;S+=X){for(var fe=S,$e=S+C*(f-L);fe<=$e;fe+=te){var pe=fe+q,De=fe+Q,rt=De+q;R?(Le(i[fe+u],i[De+u]),Ae=ae.a,Fe=ae.b,Le(i[pe+u],i[rt+u]),de=ae.a,_e=ae.b,Le(Ae,de),i[fe+u]=ae.a,i[pe+u]=ae.b,Le(Fe,_e),i[De+u]=ae.a,i[rt+u]=ae.b):(Re(i[fe+u],i[De+u]),Ae=ae.a,Fe=ae.b,Re(i[pe+u],i[rt+u]),de=ae.a,_e=ae.b,Re(Ae,de),i[fe+u]=ae.a,i[pe+u]=ae.b,Re(Fe,_e),i[De+u]=ae.a,i[rt+u]=ae.b)}if(f&H){var De=fe+Q;R?Le(i[fe+u],i[De+u]):Re(i[fe+u],i[De+u]),Ae=ae.a,i[De+u]=ae.b,i[fe+u]=Ae}}if(E&H)for(var fe=S,$e=S+C*(f-L);fe<=$e;fe+=te){var pe=fe+q;R?Le(i[fe+u],i[pe+u]):Re(i[fe+u],i[pe+u]),Ae=ae.a,i[pe+u]=ae.b,i[fe+u]=Ae}L=H,H>>=1}return S}function be(i,u,f,C,E,v,G,R,_,H){for(var L=0,S=0,ve=R,Q=Math.trunc(E.value+(v+7)/8);E.value<Q;)for(Ee(L,S,f,E),L=ee.c,S=ee.lc;S>=14;){var X=L>>S-14&16383,q=u[X];if(q.len)S-=q.len,oe(q.lit,G,L,S,f,C,E,_,H,ve),L=se.c,S=se.lc;else{if(!q.p)throw"hufDecode issues";var te;for(te=0;te<q.lit;te++){for(var Ae=le(i[q.p[te]]);S<Ae&&E.value<Q;)Ee(L,S,f,E),L=ee.c,S=ee.lc;if(S>=Ae&&Me(i[q.p[te]])==(L>>S-Ae&(1<<Ae)-1)){S-=Ae,oe(q.p[te],G,L,S,f,C,E,_,H,ve),L=se.c,S=se.lc;break}}if(te==q.lit)throw"hufDecode issues"}}var de=8-v&7;for(L>>=de,S-=de;S>0;){var q=u[L<<14-S&16383];if(q.len)S-=q.len,oe(q.lit,G,L,S,f,C,E,_,H,ve),L=se.c,S=se.lc;else throw"hufDecode issues"}return!0}function ce(i,u,f,C,E,v){var G={value:0},R=f.value,_=ye(u,f),H=ye(u,f);f.value+=4;var L=ye(u,f);if(f.value+=4,_<0||_>=65537||H<0||H>=65537)throw"Something wrong with HUF_ENCSIZE";var S=new Array(65537),ve=new Array(16384);Y(ve);var Q=C-(f.value-R);if(W(i,u,f,Q,_,H,S),L>8*(C-(f.value-R)))throw"Something wrong with hufUncompress";ge(S,_,H,ve),be(S,ve,i,u,f,L,H,v,E,G)}function Pe(i,u,f){for(var C=0;C<f;++C)u[C]=i[u[C]]}function Se(i){for(var u=1;u<i.length;u++){var f=i[u-1]+i[u]-128;i[u]=f}}function Ze(i,u){for(var f=0,C=Math.floor((i.length+1)/2),E=0,v=i.length-1;!(E>v||(u[E++]=i[f++],E>v));)u[E++]=i[C++]}function tt(i){for(var u=i.byteLength,f=new Array,C=0,E=new DataView(i);u>0;){var v=E.getInt8(C++);if(v<0){var G=-v;u-=G+1;for(var R=0;R<G;R++)f.push(E.getUint8(C++))}else{var G=v;u-=2;for(var _=E.getUint8(C++),R=0;R<G+1;R++)f.push(_)}}return f}function Kt(i,u,f,C,E,v){var pe=new DataView(v.buffer),G=f[i.idx[0]].width,R=f[i.idx[0]].height,_=3,H=Math.floor(G/8),L=Math.ceil(G/8),S=Math.ceil(R/8),ve=G-(L-1)*8,Q=R-(S-1)*8,X={value:0},q=new Array(_),te=new Array(_),Ae=new Array(_),de=new Array(_),Fe=new Array(_);for(let he=0;he<_;++he)Fe[he]=u[i.idx[he]],q[he]=he<1?0:q[he-1]+L*S,te[he]=new Float32Array(64),Ae[he]=new Uint16Array(64),de[he]=new Uint16Array(L*64);for(let he=0;he<S;++he){var _e=8;he==S-1&&(_e=Q);var fe=8;for(let Ce=0;Ce<L;++Ce){Ce==L-1&&(fe=ve);for(let ue=0;ue<_;++ue)Ae[ue].fill(0),Ae[ue][0]=E[q[ue]++],Je(X,C,Ae[ue]),mt(Ae[ue],te[ue]),ct(te[ue]);yt(te);for(let ue=0;ue<_;++ue)Qt(te[ue],de[ue],Ce*64)}let Ge=0;for(let Ce=0;Ce<_;++Ce){const ue=f[i.idx[Ce]].type;for(let Ke=8*he;Ke<8*he+_e;++Ke){Ge=Fe[Ce][Ke];for(let It=0;It<H;++It){const Oe=It*64+(Ke&7)*8;pe.setUint16(Ge+0*2*ue,de[Ce][Oe+0],!0),pe.setUint16(Ge+1*2*ue,de[Ce][Oe+1],!0),pe.setUint16(Ge+2*2*ue,de[Ce][Oe+2],!0),pe.setUint16(Ge+3*2*ue,de[Ce][Oe+3],!0),pe.setUint16(Ge+4*2*ue,de[Ce][Oe+4],!0),pe.setUint16(Ge+5*2*ue,de[Ce][Oe+5],!0),pe.setUint16(Ge+6*2*ue,de[Ce][Oe+6],!0),pe.setUint16(Ge+7*2*ue,de[Ce][Oe+7],!0),Ge+=8*2*ue}}if(H!=L)for(let Ke=8*he;Ke<8*he+_e;++Ke){const It=Fe[Ce][Ke]+8*H*2*ue,Oe=H*64+(Ke&7)*8;for(let ut=0;ut<fe;++ut)pe.setUint16(It+ut*2*ue,de[Ce][Oe+ut],!0)}}}for(var $e=new Uint16Array(G),pe=new DataView(v.buffer),De=0;De<_;++De){f[i.idx[De]].decoded=!0;var rt=f[i.idx[De]].type;if(f[De].type==2)for(var Zt=0;Zt<R;++Zt){const he=Fe[De][Zt];for(var ke=0;ke<G;++ke)$e[ke]=pe.getUint16(he+ke*2*rt,!0);for(var ke=0;ke<G;++ke)pe.setFloat32(he+ke*2*rt,w($e[ke]),!0)}}}function Je(i,u,f){for(var C,E=1;E<64;)C=u[i.value],C==65280?E=64:C>>8==255?E+=C&255:(f[E]=C,E++),i.value++}function mt(i,u){u[0]=w(i[0]),u[1]=w(i[1]),u[2]=w(i[5]),u[3]=w(i[6]),u[4]=w(i[14]),u[5]=w(i[15]),u[6]=w(i[27]),u[7]=w(i[28]),u[8]=w(i[2]),u[9]=w(i[4]),u[10]=w(i[7]),u[11]=w(i[13]),u[12]=w(i[16]),u[13]=w(i[26]),u[14]=w(i[29]),u[15]=w(i[42]),u[16]=w(i[3]),u[17]=w(i[8]),u[18]=w(i[12]),u[19]=w(i[17]),u[20]=w(i[25]),u[21]=w(i[30]),u[22]=w(i[41]),u[23]=w(i[43]),u[24]=w(i[9]),u[25]=w(i[11]),u[26]=w(i[18]),u[27]=w(i[24]),u[28]=w(i[31]),u[29]=w(i[40]),u[30]=w(i[44]),u[31]=w(i[53]),u[32]=w(i[10]),u[33]=w(i[19]),u[34]=w(i[23]),u[35]=w(i[32]),u[36]=w(i[39]),u[37]=w(i[45]),u[38]=w(i[52]),u[39]=w(i[54]),u[40]=w(i[20]),u[41]=w(i[22]),u[42]=w(i[33]),u[43]=w(i[38]),u[44]=w(i[46]),u[45]=w(i[51]),u[46]=w(i[55]),u[47]=w(i[60]),u[48]=w(i[21]),u[49]=w(i[34]),u[50]=w(i[37]),u[51]=w(i[47]),u[52]=w(i[50]),u[53]=w(i[56]),u[54]=w(i[59]),u[55]=w(i[61]),u[56]=w(i[35]),u[57]=w(i[36]),u[58]=w(i[48]),u[59]=w(i[49]),u[60]=w(i[57]),u[61]=w(i[58]),u[62]=w(i[62]),u[63]=w(i[63])}function ct(i){const u=.5*Math.cos(.7853975),f=.5*Math.cos(3.14159/16),C=.5*Math.cos(3.14159/8),E=.5*Math.cos(3*3.14159/16),v=.5*Math.cos(5*3.14159/16),G=.5*Math.cos(3*3.14159/8),R=.5*Math.cos(7*3.14159/16);for(var _=new Array(4),H=new Array(4),L=new Array(4),S=new Array(4),ve=0;ve<8;++ve){var Q=ve*8;_[0]=C*i[Q+2],_[1]=G*i[Q+2],_[2]=C*i[Q+6],_[3]=G*i[Q+6],H[0]=f*i[Q+1]+E*i[Q+3]+v*i[Q+5]+R*i[Q+7],H[1]=E*i[Q+1]-R*i[Q+3]-f*i[Q+5]-v*i[Q+7],H[2]=v*i[Q+1]-f*i[Q+3]+R*i[Q+5]+E*i[Q+7],H[3]=R*i[Q+1]-v*i[Q+3]+E*i[Q+5]-f*i[Q+7],L[0]=u*(i[Q+0]+i[Q+4]),L[3]=u*(i[Q+0]-i[Q+4]),L[1]=_[0]+_[3],L[2]=_[1]-_[2],S[0]=L[0]+L[1],S[1]=L[3]+L[2],S[2]=L[3]-L[2],S[3]=L[0]-L[1],i[Q+0]=S[0]+H[0],i[Q+1]=S[1]+H[1],i[Q+2]=S[2]+H[2],i[Q+3]=S[3]+H[3],i[Q+4]=S[3]-H[3],i[Q+5]=S[2]-H[2],i[Q+6]=S[1]-H[1],i[Q+7]=S[0]-H[0]}for(var X=0;X<8;++X)_[0]=C*i[16+X],_[1]=G*i[16+X],_[2]=C*i[48+X],_[3]=G*i[48+X],H[0]=f*i[8+X]+E*i[24+X]+v*i[40+X]+R*i[56+X],H[1]=E*i[8+X]-R*i[24+X]-f*i[40+X]-v*i[56+X],H[2]=v*i[8+X]-f*i[24+X]+R*i[40+X]+E*i[56+X],H[3]=R*i[8+X]-v*i[24+X]+E*i[40+X]-f*i[56+X],L[0]=u*(i[X]+i[32+X]),L[3]=u*(i[X]-i[32+X]),L[1]=_[0]+_[3],L[2]=_[1]-_[2],S[0]=L[0]+L[1],S[1]=L[3]+L[2],S[2]=L[3]-L[2],S[3]=L[0]-L[1],i[0+X]=S[0]+H[0],i[8+X]=S[1]+H[1],i[16+X]=S[2]+H[2],i[24+X]=S[3]+H[3],i[32+X]=S[3]-H[3],i[40+X]=S[2]-H[2],i[48+X]=S[1]-H[1],i[56+X]=S[0]-H[0]}function yt(i){for(var u=0;u<64;++u){var f=i[0][u],C=i[1][u],E=i[2][u];i[0][u]=f+1.5747*E,i[1][u]=f-.1873*C-.4682*E,i[2][u]=f+1.8556*C}}function Qt(i,u,f){for(var C=0;C<64;++C)u[f+C]=Ut.toHalfFloat(Gt(i[C]))}function Gt(i){return i<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(I,Math.abs(i)-1)}function lt(i){return new DataView(i.array.buffer,i.offset.value,i.size)}function nt(i){var u=i.viewer.buffer.slice(i.offset.value,i.offset.value+i.size),f=new Uint8Array(tt(u)),C=new Uint8Array(f.length);return Se(f),Ze(f,C),new DataView(C.buffer)}function Ct(i){var u=i.array.slice(i.offset.value,i.offset.value+i.size),f=An(u),C=new Uint8Array(f.length);return Se(f),Ze(f,C),new DataView(C.buffer)}function Xt(i){for(var u=i.viewer,f={value:i.offset.value},C=new Uint16Array(i.width*i.scanlineBlockSize*(i.channels*i.type)),E=new Uint8Array(8192),v=0,G=new Array(i.channels),R=0;R<i.channels;R++)G[R]={},G[R].start=v,G[R].end=G[R].start,G[R].nx=i.width,G[R].ny=i.lines,G[R].size=i.type,v+=G[R].nx*G[R].ny*G[R].size;var _=He(u,f),H=He(u,f);if(H>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(_<=H)for(var R=0;R<H-_+1;R++)E[R+_]=p(u,f);var L=new Uint16Array(65536),S=U(E,L),ve=ye(u,f);ce(i.array,u,f,ve,C,v);for(var R=0;R<i.channels;++R)for(var Q=G[R],X=0;X<G[R].size;++X)bt(C,Q.start+X,Q.nx,Q.size,Q.ny,Q.nx*Q.size,S);Pe(L,C,v);for(var q=0,te=new Uint8Array(C.buffer.byteLength),Ae=0;Ae<i.lines;Ae++)for(var de=0;de<i.channels;de++){var Q=G[de],Fe=Q.nx*Q.size,_e=new Uint8Array(C.buffer,Q.end*2,Fe*2);te.set(_e,q),q+=Fe*2,Q.end+=Fe}return new DataView(te.buffer)}function Ne(i){var u=i.array.slice(i.offset.value,i.offset.value+i.size),f=An(u);const C=i.lines*i.channels*i.width,E=i.type==1?new Uint16Array(C):new Uint32Array(C);let v=0,G=0;const R=new Array(4);for(let _=0;_<i.lines;_++)for(let H=0;H<i.channels;H++){let L=0;switch(i.type){case 1:R[0]=v,R[1]=R[0]+i.width,v=R[1]+i.width;for(let S=0;S<i.width;++S){const ve=f[R[0]++]<<8|f[R[1]++];L+=ve,E[G]=L,G++}break;case 2:R[0]=v,R[1]=R[0]+i.width,R[2]=R[1]+i.width,v=R[2]+i.width;for(let S=0;S<i.width;++S){const ve=f[R[0]++]<<24|f[R[1]++]<<16|f[R[2]++]<<8;L+=ve,E[G]=L,G++}break}}return new DataView(E.buffer)}function wt(i){var u=i.viewer,f={value:i.offset.value},C=new Uint8Array(i.width*i.lines*(i.channels*i.type*2)),E={version:y(u,f),unknownUncompressedSize:y(u,f),unknownCompressedSize:y(u,f),acCompressedSize:y(u,f),dcCompressedSize:y(u,f),rleCompressedSize:y(u,f),rleUncompressedSize:y(u,f),rleRawSize:y(u,f),totalAcUncompressedCount:y(u,f),totalDcUncompressedCount:y(u,f),acCompression:y(u,f)};if(E.version<2)throw"EXRLoader.parse: "+Yt.compression+" version "+E.version+" is unsupported";for(var v=new Array,G=He(u,f)-2;G>0;){var R=St(u.buffer,f),_=p(u,f),H=_>>2&3,L=(_>>4)-1,S=new Int8Array([L])[0],ve=p(u,f);v.push({name:R,index:S,type:ve,compression:H}),G-=R.length+3}for(var Q=Yt.channels,X=new Array(i.channels),q=0;q<i.channels;++q){var te=X[q]={},Ae=Q[q];te.name=Ae.name,te.compression=0,te.decoded=!1,te.type=Ae.pixelType,te.pLinear=Ae.pLinear,te.width=i.width,te.height=i.lines}for(var de={idx:new Array(3)},Fe=0;Fe<i.channels;++Fe)for(var te=X[Fe],q=0;q<v.length;++q){var _e=v[q];te.name==_e.name&&(te.compression=_e.compression,_e.index>=0&&(de.idx[_e.index]=Fe),te.offset=Fe)}if(E.acCompressedSize>0)switch(E.acCompression){case 0:var pe=new Uint16Array(E.totalAcUncompressedCount);ce(i.array,u,f,E.acCompressedSize,pe,E.totalAcUncompressedCount);break;case 1:var fe=i.array.slice(f.value,f.value+E.totalAcUncompressedCount),$e=An(fe),pe=new Uint16Array($e.buffer);f.value+=E.totalAcUncompressedCount;break}if(E.dcCompressedSize>0){var De={array:i.array,offset:f,size:E.dcCompressedSize},rt=new Uint16Array(Ct(De).buffer);f.value+=E.dcCompressedSize}if(E.rleRawSize>0){var fe=i.array.slice(f.value,f.value+E.rleCompressedSize),$e=An(fe),Zt=tt($e.buffer);f.value+=E.rleCompressedSize}for(var ke=0,he=new Array(X.length),q=0;q<he.length;++q)he[q]=new Array;for(var Ge=0;Ge<i.lines;++Ge)for(var Ce=0;Ce<X.length;++Ce)he[Ce].push(ke),ke+=X[Ce].width*i.type*2;Kt(de,he,X,pe,rt,C);for(var q=0;q<X.length;++q){var te=X[q];if(!te.decoded)switch(te.compression){case 2:for(var ue=0,Ke=0,Ge=0;Ge<i.lines;++Ge){for(var It=he[q][ue],Oe=0;Oe<te.width;++Oe){for(var ut=0;ut<2*te.type;++ut)C[It++]=Zt[Ke+ut*te.width*te.height];Ke++}ue++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(C.buffer)}function St(i,u){for(var f=new Uint8Array(i),C=0;f[u.value+C]!=0;)C+=1;var E=new TextDecoder().decode(f.slice(u.value,u.value+C));return u.value=u.value+C+1,E}function In(i,u,f){var C=new TextDecoder().decode(new Uint8Array(i).slice(u.value,u.value+f));return u.value=u.value+f,C}function cn(i,u){var f=gt(i,u),C=ye(i,u);return[f,C]}function Fn(i,u){var f=ye(i,u),C=ye(i,u);return[f,C]}function gt(i,u){var f=i.getInt32(u.value,!0);return u.value=u.value+4,f}function ye(i,u){var f=i.getUint32(u.value,!0);return u.value=u.value+4,f}function Ht(i,u){var f=i[u.value];return u.value=u.value+1,f}function p(i,u){var f=i.getUint8(u.value);return u.value=u.value+1,f}const y=function(i,u){let f;return"getBigInt64"in DataView.prototype?f=Number(i.getBigInt64(u.value,!0)):f=i.getUint32(u.value+4,!0)+Number(i.getUint32(u.value,!0)<<32),u.value+=8,f};function k(i,u){var f=i.getFloat32(u.value,!0);return u.value+=4,f}function ie(i,u){return Ut.toHalfFloat(k(i,u))}function w(i){var u=(i&31744)>>10,f=i&1023;return(i>>15?-1:1)*(u?u===31?f?NaN:1/0:Math.pow(2,u-15)*(1+f/1024):6103515625e-14*(f/1024))}function He(i,u){var f=i.getUint16(u.value,!0);return u.value+=2,f}function qe(i,u){return w(He(i,u))}function rr(i,u,f,C){for(var E=f.value,v=[];f.value<E+C-1;){var G=St(u,f),R=gt(i,f),_=p(i,f);f.value+=3;var H=gt(i,f),L=gt(i,f);v.push({name:G,pixelType:R,pLinear:_,xSampling:H,ySampling:L})}return f.value+=1,v}function ln(i,u){var f=k(i,u),C=k(i,u),E=k(i,u),v=k(i,u),G=k(i,u),R=k(i,u),_=k(i,u),H=k(i,u);return{redX:f,redY:C,greenX:E,greenY:v,blueX:G,blueY:R,whiteX:_,whiteY:H}}function We(i,u){var f=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],C=p(i,u);return f[C]}function Ve(i,u){var f=ye(i,u),C=ye(i,u),E=ye(i,u),v=ye(i,u);return{xMin:f,yMin:C,xMax:E,yMax:v}}function Et(i,u){var f=["INCREASING_Y"],C=p(i,u);return f[C]}function vt(i,u){var f=k(i,u),C=k(i,u);return[f,C]}function Mt(i,u){var f=k(i,u),C=k(i,u),E=k(i,u);return[f,C,E]}function _t(i,u,f,C,E){if(C==="string"||C==="stringvector"||C==="iccProfile")return In(u,f,E);if(C==="chlist")return rr(i,u,f,E);if(C==="chromaticities")return ln(i,f);if(C==="compression")return We(i,f);if(C==="box2i")return Ve(i,f);if(C==="lineOrder")return Et(i,f);if(C==="float")return k(i,f);if(C==="v2f")return vt(i,f);if(C==="v3f")return Mt(i,f);if(C==="int")return gt(i,f);if(C==="rational")return cn(i,f);if(C==="timecode")return Fn(i,f);if(C==="preview")return f.value+=E,"skipped";f.value+=E}function Wr(i,u,f){const C={};if(i.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";C.version=i.getUint8(4);const E=i.getUint8(5);C.spec={singleTile:!!(E&2),longName:!!(E&4),deepFormat:!!(E&8),multiPart:!!(E&16)},f.value=8;for(var v=!0;v;){var G=St(u,f);if(G==0)v=!1;else{var R=St(u,f),_=ye(i,f),H=_t(i,u,f,R,_);H===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${R}'.`):C[G]=H}}if(E&-5)throw console.error("EXRHeader:",C),"THREE.EXRLoader: provided file is currently unsupported.";return C}function Vr(i,u,f,C,E){const v={size:0,viewer:u,array:f,offset:C,width:i.dataWindow.xMax-i.dataWindow.xMin+1,height:i.dataWindow.yMax-i.dataWindow.yMin+1,channels:i.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:i.channels[0].pixelType,uncompress:null,getter:null,format:null,[Vt?"colorSpace":"encoding"]:null};switch(i.compression){case"NO_COMPRESSION":v.lines=1,v.uncompress=lt;break;case"RLE_COMPRESSION":v.lines=1,v.uncompress=nt;break;case"ZIPS_COMPRESSION":v.lines=1,v.uncompress=Ct;break;case"ZIP_COMPRESSION":v.lines=16,v.uncompress=Ct;break;case"PIZ_COMPRESSION":v.lines=32,v.uncompress=Xt;break;case"PXR24_COMPRESSION":v.lines=16,v.uncompress=Ne;break;case"DWAA_COMPRESSION":v.lines=32,v.uncompress=wt;break;case"DWAB_COMPRESSION":v.lines=256,v.uncompress=wt;break;default:throw"EXRLoader.parse: "+i.compression+" is unsupported"}if(v.scanlineBlockSize=v.lines,v.type==1)switch(E){case it:v.getter=qe,v.inputSize=2;break;case Ye:v.getter=He,v.inputSize=2;break}else if(v.type==2)switch(E){case it:v.getter=k,v.inputSize=4;break;case Ye:v.getter=ie,v.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+v.type+" for "+i.compression+".";v.blockCount=(i.dataWindow.yMax+1)/v.scanlineBlockSize;for(var G=0;G<v.blockCount;G++)y(u,C);v.outputChannels=v.channels==3?4:v.channels;const R=v.width*v.height*v.outputChannels;switch(E){case it:v.byteArray=new Float32Array(R),v.channels<v.outputChannels&&v.byteArray.fill(1,0,R);break;case Ye:v.byteArray=new Uint16Array(R),v.channels<v.outputChannels&&v.byteArray.fill(15360,0,R);break;default:console.error("THREE.EXRLoader: unsupported type: ",E);break}return v.bytesPerLine=v.width*v.inputSize*v.channels,v.outputChannels==4?v.format=nn:v.format=Us,Vt?v.colorSpace="srgb-linear":v.encoding=3e3,v}const un=new DataView(e),zr=new Uint8Array(e),jt={value:0},Yt=Wr(un,e,jt),re=Vr(Yt,un,zr,jt,this.type),sr={value:0},qr={R:0,G:1,B:2,A:3,Y:0};for(let i=0;i<re.height/re.scanlineBlockSize;i++){const u=ye(un,jt);re.size=ye(un,jt),re.lines=u+re.scanlineBlockSize>re.height?re.height-u:re.scanlineBlockSize;const C=re.size<re.lines*re.bytesPerLine?re.uncompress(re):lt(re);jt.value+=re.size;for(let E=0;E<re.scanlineBlockSize;E++){const v=E+i*re.scanlineBlockSize;if(v>=re.height)break;for(let G=0;G<re.channels;G++){const R=qr[Yt.channels[G].name];for(let _=0;_<re.width;_++){sr.value=(E*(re.channels*re.width)+G*re.width+_)*re.inputSize;const H=(re.height-1-v)*(re.width*re.outputChannels)+_*re.outputChannels+R;re.byteArray[H]=re.getter(C,sr)}}}}return{header:Yt,width:re.width,height:re.height,data:re.byteArray,format:re.format,[Vt?"colorSpace":"encoding"]:re[Vt?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,n,t,r){function s(a,c){Vt?a.colorSpace=c.colorSpace:a.encoding=c.encoding,a.minFilter=je,a.magFilter=je,a.generateMipmaps=!1,a.flipY=!1,n&&n(a,c)}return super.load(e,s,t,r)}}const Sn=new WeakMap;class Ei extends Qn{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,t,r){const s=new Bt(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const c={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,c).then(n).catch(r)},t,r)}decodeDracoFile(e,n,t,r){const s={attributeIDs:t||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!t};this.decodeGeometry(e,s).then(n)}decodeGeometry(e,n){for(const o in n.attributeTypes){const A=n.attributeTypes[o];A.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[o]=A.name)}const t=JSON.stringify(n);if(Sn.has(e)){const o=Sn.get(e);if(o.key===t)return o.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,a=e.byteLength,c=this._getWorker(s,a).then(o=>(r=o,new Promise((A,h)=>{r._callbacks[s]={resolve:A,reject:h},r.postMessage({type:"decode",id:s,taskConfig:n,buffer:e},[e])}))).then(o=>this._createGeometry(o.geometry));return c.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),Sn.set(e,{key:t,promise:c}),c}_createGeometry(e){const n=new Dr;e.index&&n.setIndex(new $t(e.index.array,1));for(let t=0;t<e.attributes.length;t++){const r=e.attributes[t],s=r.name,a=r.array,c=r.itemSize;n.setAttribute(s,new $t(a,c))}return n}_loadLibrary(e,n){const t=new Bt(this.manager);return t.setPath(this.decoderPath),t.setResponseType(n),t.setWithCredentials(this.withCredentials),new Promise((r,s)=>{t.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const s=vi.toString(),a=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const a=s.data;switch(a.type){case"decode":r._callbacks[a.id].resolve(a);break;case"error":r._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskCosts[e]=n,t._taskLoad+=n,t})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function vi(){let l,e;onmessage=function(a){const c=a.data;switch(c.type){case"init":l=c.decoderConfig,e=new Promise(function(h){l.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(l)});break;case"decode":const o=c.buffer,A=c.taskConfig;e.then(h=>{const d=h.draco,B=new d.Decoder,m=new d.DecoderBuffer;m.Init(new Int8Array(o),o.byteLength);try{const g=n(d,B,m,A),T=g.attributes.map(M=>M.array.buffer);g.index&&T.push(g.index.array.buffer),self.postMessage({type:"decode",id:c.id,geometry:g},T)}catch(g){console.error(g),self.postMessage({type:"error",id:c.id,error:g.message})}finally{d.destroy(m),d.destroy(B)}});break}};function n(a,c,o,A){const h=A.attributeIDs,d=A.attributeTypes;let B,m;const g=c.GetEncodedGeometryType(o);if(g===a.TRIANGULAR_MESH)B=new a.Mesh,m=c.DecodeBufferToMesh(o,B);else if(g===a.POINT_CLOUD)B=new a.PointCloud,m=c.DecodeBufferToPointCloud(o,B);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||B.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const T={index:null,attributes:[]};for(const M in h){const D=self[d[M]];let x,N;if(A.useUniqueIDs)N=h[M],x=c.GetAttributeByUniqueId(B,N);else{if(N=c.GetAttributeId(B,a[h[M]]),N===-1)continue;x=c.GetAttribute(B,N)}T.attributes.push(r(a,c,B,M,D,x))}return g===a.TRIANGULAR_MESH&&(T.index=t(a,c,B)),a.destroy(B),T}function t(a,c,o){const h=o.num_faces()*3,d=h*4,B=a._malloc(d);c.GetTrianglesUInt32Array(o,d,B);const m=new Uint32Array(a.HEAPF32.buffer,B,h).slice();return a._free(B),{array:m,itemSize:1}}function r(a,c,o,A,h,d){const B=d.num_components(),g=o.num_points()*B,T=g*h.BYTES_PER_ELEMENT,M=s(a,h),D=a._malloc(T);c.GetAttributeDataArrayForAllPoints(o,d,M,T,D);const x=new h(a.HEAPF32.buffer,D,g).slice();return a._free(D),{name:A,array:x,itemSize:B}}function s(a,c){switch(c){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let dn;const Hn=()=>{if(dn)return dn;const l="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",e="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",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),t=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let r=l;WebAssembly.validate(n)&&(r=e);let s;const a=WebAssembly.instantiate(c(r),{}).then(d=>{s=d.instance,s.exports.__wasm_call_ctors()});function c(d){const B=new Uint8Array(d.length);for(let g=0;g<d.length;++g){const T=d.charCodeAt(g);B[g]=T>96?T-71:T>64?T-65:T>47?T+4:T>46?63:62}let m=0;for(let g=0;g<d.length;++g)B[m++]=B[g]<60?t[B[g]]:(B[g]-60)*64+B[++g];return B.buffer.slice(0,m)}function o(d,B,m,g,T,M){const D=s.exports.sbrk,x=m+3&-4,N=D(x*g),P=D(T.length),O=new Uint8Array(s.exports.memory.buffer);O.set(T,P);const b=d(N,m,g,P,T.length);if(b===0&&M&&M(N,x,g),B.set(O.subarray(N,N+m*g)),D(N-D(0)),b!==0)throw new Error(`Malformed buffer data: ${b}`)}const A={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return dn={ready:a,supported:!0,decodeVertexBuffer(d,B,m,g,T){o(s.exports.meshopt_decodeVertexBuffer,d,B,m,g,s.exports[A[T]])},decodeIndexBuffer(d,B,m,g){o(s.exports.meshopt_decodeIndexBuffer,d,B,m,g)},decodeIndexSequence(d,B,m,g){o(s.exports.meshopt_decodeIndexSequence,d,B,m,g)},decodeGltfBuffer(d,B,m,g,T,M){o(s.exports[h[T]],d,B,m,g,s.exports[A[M]])}},dn};let fn=null,Nr="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function kr(l=!0,e=!0,n){return t=>{n&&n(t),l&&(fn||(fn=new Ei),fn.setDecoderPath(typeof l=="string"?l:Nr),t.setDRACOLoader(fn)),e&&t.setMeshoptDecoder(typeof Hn=="function"?Hn():Hn)}}const Wn=(l,e,n,t)=>Dt(Zn,l,kr(e,n,t));Wn.preload=(l,e,n,t)=>Dt.preload(Zn,l,kr(e,n,t));Wn.clear=l=>Dt.clear(Zn,l);Wn.setDecoderPath=l=>{Nr=l};const Yi=J.forwardRef(({makeDefault:l,camera:e,regress:n,domElement:t,enableDamping:r=!0,keyEvents:s=!1,onChange:a,onStart:c,onEnd:o,...A},h)=>{const d=we(b=>b.invalidate),B=we(b=>b.camera),m=we(b=>b.gl),g=we(b=>b.events),T=we(b=>b.setEvents),M=we(b=>b.set),D=we(b=>b.get),x=we(b=>b.performance),N=e||B,P=t||g.connected||m.domElement,O=J.useMemo(()=>new _a(N),[N]);return vn(()=>{O.enabled&&O.update()},-1),J.useEffect(()=>(s&&O.connect(s===!0?P:s),O.connect(P),()=>void O.dispose()),[s,P,n,O,d]),J.useEffect(()=>{const b=I=>{d(),n&&x.regress(),a&&a(I)},Z=I=>{c&&c(I)},F=I=>{o&&o(I)};return O.addEventListener("change",b),O.addEventListener("start",Z),O.addEventListener("end",F),()=>{O.removeEventListener("start",Z),O.removeEventListener("end",F),O.removeEventListener("change",b)}},[a,c,o,O,d,T]),J.useEffect(()=>{if(l){const b=D().controls;return M({controls:O}),()=>M({controls:b})}},[l,O]),J.createElement("primitive",kt({ref:h,object:O,enableDamping:r},A))}),Mi=3e3,Ii=3001,Kr=(l,e,n)=>{let t;switch(l){case On:t=new Uint8ClampedArray(e*n*4);break;case Ye:t=new Uint16Array(e*n*4);break;case Qs:t=new Uint32Array(e*n*4);break;case Ks:t=new Int8Array(e*n*4);break;case ks:t=new Int16Array(e*n*4);break;case Ns:t=new Int32Array(e*n*4);break;case it:t=new Float32Array(e*n*4);break;default:throw new Error("Unsupported data type")}return t};let Bn;const Fi=(l,e,n,t)=>{if(Bn!==void 0)return Bn;const r=new Cn(1,1,t);e.setRenderTarget(r);const s=new sn(new Xn,new Ot({color:16777215}));e.render(s,n),e.setRenderTarget(null);const a=Kr(l,r.width,r.height);return e.readRenderTargetPixels(r,0,0,r.width,r.height,a),r.dispose(),s.geometry.dispose(),s.material.dispose(),Bn=a[0]!==0,Bn};class Vn{constructor(e){Ie(this,"_renderer");Ie(this,"_rendererIsDisposable",!1);Ie(this,"_material");Ie(this,"_scene");Ie(this,"_camera");Ie(this,"_quad");Ie(this,"_renderTarget");Ie(this,"_width");Ie(this,"_height");Ie(this,"_type");Ie(this,"_colorSpace");Ie(this,"_supportsReadPixels",!0);Ie(this,"render",()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)});var t,r,s,a,c,o,A,h,d,B,m,g,T,M,D,x;this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const n={format:nn,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((t=e.renderTargetOptions)==null?void 0:t.anisotropy)!==void 0?(r=e.renderTargetOptions)==null?void 0:r.anisotropy:1,generateMipmaps:((s=e.renderTargetOptions)==null?void 0:s.generateMipmaps)!==void 0?(a=e.renderTargetOptions)==null?void 0:a.generateMipmaps:!1,magFilter:((c=e.renderTargetOptions)==null?void 0:c.magFilter)!==void 0?(o=e.renderTargetOptions)==null?void 0:o.magFilter:je,minFilter:((A=e.renderTargetOptions)==null?void 0:A.minFilter)!==void 0?(h=e.renderTargetOptions)==null?void 0:h.minFilter:je,samples:((d=e.renderTargetOptions)==null?void 0:d.samples)!==void 0?(B=e.renderTargetOptions)==null?void 0:B.samples:void 0,wrapS:((m=e.renderTargetOptions)==null?void 0:m.wrapS)!==void 0?(g=e.renderTargetOptions)==null?void 0:g.wrapS:at,wrapT:((T=e.renderTargetOptions)==null?void 0:T.wrapT)!==void 0?(M=e.renderTargetOptions)==null?void 0:M.wrapT:at};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=Vn.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Gr,this._camera=new Rt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Fi(this._type,this._renderer,this._camera,n)){let N;switch(this._type){case Ye:N=this._renderer.extensions.has("EXT_color_buffer_float")?it:void 0;break}N!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${it}`),this._type=N):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new sn(new Xn,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Cn(this.width,this.height,n),this._renderTarget.texture.mapping=((D=e.renderTargetOptions)==null?void 0:D.mapping)!==void 0?(x=e.renderTargetOptions)==null?void 0:x.mapping:gn}static instantiateRenderer(){const e=new Ps;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=Kr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const n=new Js(this.toArray(),this.width,this.height,nn,this._type,(e==null?void 0:e.mapping)||gn,(e==null?void 0:e.wrapS)||at,(e==null?void 0:e.wrapT)||at,(e==null?void 0:e.magFilter)||je,(e==null?void 0:e.minFilter)||je,(e==null?void 0:e.anisotropy)||1,Ln);return n.generateMipmaps=(e==null?void 0:e.generateMipmaps)!==void 0?e==null?void 0:e.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof tn&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof dt&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof dt&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Qr extends Error{}class Xr extends Error{}const zt=(l,e,n)=>{const t=new RegExp(`${e}="([^"]*)"`,"i").exec(l);if(t)return t[1];const r=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(l);if(r){const s=r[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(a=>a.replace(/<\/?rdf:li>/g,"")):r[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${e} in gainmap metadata`)},Ti=l=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(l):e=l.toString();let n=e.indexOf("<x:xmpmeta");for(;n!==-1;){const t=e.indexOf("x:xmpmeta>",n),r=e.slice(n,t+10);try{const s=zt(r,"hdrgm:GainMapMin","0"),a=zt(r,"hdrgm:GainMapMax"),c=zt(r,"hdrgm:Gamma","1"),o=zt(r,"hdrgm:OffsetSDR","0.015625"),A=zt(r,"hdrgm:OffsetHDR","0.015625"),h=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(r),d=h?h[1]:"0",B=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(r);if(!B)throw new Error("Incomplete gainmap metadata");const m=B[1];return{gainMapMin:Array.isArray(s)?s.map(g=>parseFloat(g)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(a)?a.map(g=>parseFloat(g)):[parseFloat(a),parseFloat(a),parseFloat(a)],gamma:Array.isArray(c)?c.map(g=>parseFloat(g)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(o)?o.map(g=>parseFloat(g)):[parseFloat(o),parseFloat(o),parseFloat(o)],offsetHdr:Array.isArray(A)?A.map(g=>parseFloat(g)):[parseFloat(A),parseFloat(A),parseFloat(A)],hdrCapacityMin:parseFloat(d),hdrCapacityMax:parseFloat(m)}}catch{}n=e.indexOf("<x:xmpmeta",t)}};class Ri{constructor(e){Ie(this,"options");this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((n,t)=>{const r=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const a=s.byteLength;let c=2,o=0,A;for(;c<a;){if(++o>250){t(new Error(`Found no marker after ${o} loops `));return}if(s.getUint8(c)!==255){t(new Error(`Not a valid marker at offset 0x${c.toString(16)}, found: 0x${s.getUint8(c).toString(16)}`));return}if(A=s.getUint8(c+1),r&&console.log(`Marker: ${A.toString(16)}`),A===226){r&&console.log("Found APP2 marker (0xffe2)");const h=c+4;if(s.getUint32(h)===1297106432){const d=h+4;let B;if(s.getUint16(d)===18761)B=!1;else if(s.getUint16(d)===19789)B=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(d+2,!B)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const m=s.getUint32(d+4,!B);if(m<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const g=d+m,T=s.getUint16(g,!B),M=g+2;let D=0;for(let O=M;O<M+12*T;O+=12)s.getUint16(O,!B)===45057&&(D=s.getUint32(O+8,!B));const N=g+2+T*12+4,P=[];for(let O=N;O<N+D*16;O+=16){const b={MPType:s.getUint32(O,!B),size:s.getUint32(O+4,!B),dataOffset:s.getUint32(O+8,!B),dependantImages:s.getUint32(O+12,!B),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=d+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,P.push(b)}if(this.options.extractNonFII&&P.length){const O=new Blob([s]),b=[];for(const Z of P){if(Z.isFII&&!this.options.extractFII)continue;const F=O.slice(Z.start,Z.end+1,"image/jpeg");b.push(F)}n(b)}}}c+=2+s.getUint16(c+2)}})}}const Di=async l=>{const e=Ti(l);if(!e)throw new Xr("Gain map XMP metadata not found");const t=await new Ri({extractFII:!0,extractNonFII:!0}).extract(l);if(t.length!==2)throw new Qr("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:e}},Mr=l=>new Promise((e,n)=>{const t=document.createElement("img");t.onload=()=>{e(t)},t.onerror=r=>{n(r)},t.src=URL.createObjectURL(l)});class bi extends Qn{constructor(n,t){super(t);Ie(this,"_renderer");Ie(this,"_renderTargetOptions");Ie(this,"_internalLoadingManager");Ie(this,"_config");this._config=n,n.renderer&&(this._renderer=n.renderer),this._internalLoadingManager=new Xs}setRenderer(n){return this._renderer=n,this}setRenderTargetOptions(n){return this._renderTargetOptions=n,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const n=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new dt,sdr:new dt});return this._config.createQuadRenderer({width:16,height:16,type:Ye,colorSpace:Ln,material:n,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(n,t,r){const s=t?new Blob([t],{type:"image/jpeg"}):void 0,a=new Blob([n],{type:"image/jpeg"});let c,o,A=!1;if(typeof createImageBitmap>"u"){const h=await Promise.all([s?Mr(s):Promise.resolve(void 0),Mr(a)]);o=h[0],c=h[1],A=r==="flipY"}else{const h=await Promise.all([s?createImageBitmap(s,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(a,{imageOrientation:r||"flipY"})]);o=h[0],c=h[1]}return{sdrImage:c,gainMapImage:o,needsFlip:A}}createTextures(n,t,r){const s=new dt(t||new ImageData(2,2),gn,at,at,je,lr,nn,On,1,Ln);s.flipY=r,s.needsUpdate=!0;const a=new dt(n,gn,at,at,je,lr,nn,On,1,js);return a.flipY=r,a.needsUpdate=!0,{gainMap:s,sdr:a}}updateQuadRenderer(n,t,r,s,a){n.width=t.width,n.height=t.height,n.material.gainMap=r,n.material.sdr=s,n.material.gainMapMin=a.gainMapMin,n.material.gainMapMax=a.gainMapMax,n.material.offsetHdr=a.offsetHdr,n.material.offsetSdr=a.offsetSdr,n.material.gamma=a.gamma,n.material.hdrCapacityMin=a.hdrCapacityMin,n.material.hdrCapacityMax=a.hdrCapacityMax,n.material.maxDisplayBoost=Math.pow(2,a.hdrCapacityMax),n.material.needsUpdate=!0}}const yi=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Gi=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class wi extends tn{constructor({gamma:n,offsetHdr:t,offsetSdr:r,gainMapMin:s,gainMapMax:a,maxDisplayBoost:c,hdrCapacityMin:o,hdrCapacityMax:A,sdr:h,gainMap:d}){super({name:"GainMapDecoderMaterial",vertexShader:yi,fragmentShader:Gi,uniforms:{sdr:{value:h},gainMap:{value:d},gamma:{value:new Be(1/n[0],1/n[1],1/n[2])},offsetHdr:{value:new Be().fromArray(t)},offsetSdr:{value:new Be().fromArray(r)},gainMapMin:{value:new Be().fromArray(s)},gainMapMax:{value:new Be().fromArray(a)},weightFactor:{value:(Math.log2(c)-o)/(A-o)}},blending:Ys,depthTest:!1,depthWrite:!1});Ie(this,"_maxDisplayBoost");Ie(this,"_hdrCapacityMin");Ie(this,"_hdrCapacityMax");this._maxDisplayBoost=c,this._hdrCapacityMin=o,this._hdrCapacityMax=A,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(n){this.uniforms.sdr.value=n}get gainMap(){return this.uniforms.gainMap.value}set gainMap(n){this.uniforms.gainMap.value=n}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(n){this.uniforms.offsetHdr.value.fromArray(n)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(n){this.uniforms.offsetSdr.value.fromArray(n)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(n){this.uniforms.gainMapMin.value.fromArray(n)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(n){this.uniforms.gainMapMax.value.fromArray(n)}get gamma(){const n=this.uniforms.gamma.value;return[1/n.x,1/n.y,1/n.z]}set gamma(n){const t=this.uniforms.gamma.value;t.x=1/n[0],t.y=1/n[1],t.z=1/n[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(n){this._hdrCapacityMin=n,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(n){this._hdrCapacityMax=n,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(n){this._maxDisplayBoost=Math.max(1,Math.min(65504,n)),this.calculateWeight()}calculateWeight(){const n=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,n))}}class jr extends bi{constructor(e,n){super({renderer:e,createMaterial:t=>new wi(t),createQuadRenderer:t=>new Vn(t)},n)}async render(e,n,t,r){const{sdrImage:s,gainMapImage:a,needsFlip:c}=await this.processImages(t,r,"flipY"),{gainMap:o,sdr:A}=this.createTextures(s,a,c);this.updateQuadRenderer(e,s,o,A,n),e.render()}}class Si extends jr{load([e,n,t],r,s,a){const c=this.prepareQuadRenderer();let o,A,h;const d=async()=>{if(o&&A&&h){try{await this.render(c,h,o,A)}catch(I){this.manager.itemError(e),this.manager.itemError(n),this.manager.itemError(t),typeof a=="function"&&a(I),c.disposeOnDemandRenderer();return}typeof r=="function"&&r(c),this.manager.itemEnd(e),this.manager.itemEnd(n),this.manager.itemEnd(t),c.disposeOnDemandRenderer()}};let B=!0,m=0,g=0,T=!0,M=0,D=0,x=!0,N=0,P=0;const O=()=>{if(typeof s=="function"){const I=m+M+N,U=g+D+P,Y=B&&T&&x;s(new ProgressEvent("progress",{lengthComputable:Y,loaded:U,total:I}))}};this.manager.itemStart(e),this.manager.itemStart(n),this.manager.itemStart(t);const b=new Bt(this._internalLoadingManager);b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(this.withCredentials),b.load(e,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");o=I,await d()},I=>{B=I.lengthComputable,g=I.loaded,m=I.total,O()},I=>{this.manager.itemError(e),typeof a=="function"&&a(I)});const Z=new Bt(this._internalLoadingManager);Z.setResponseType("arraybuffer"),Z.setRequestHeader(this.requestHeader),Z.setPath(this.path),Z.setWithCredentials(this.withCredentials),Z.load(n,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");A=I,await d()},I=>{T=I.lengthComputable,D=I.loaded,M=I.total,O()},I=>{this.manager.itemError(n),typeof a=="function"&&a(I)});const F=new Bt(this._internalLoadingManager);return F.setRequestHeader(this.requestHeader),F.setPath(this.path),F.setWithCredentials(this.withCredentials),F.load(t,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");h=JSON.parse(I),await d()},I=>{x=I.lengthComputable,P=I.loaded,N=I.total,O()},I=>{this.manager.itemError(t),typeof a=="function"&&a(I)}),c}}class Hi extends jr{load(e,n,t,r){const s=this.prepareQuadRenderer(),a=new Bt(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async c=>{if(typeof c=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const o=new Uint8Array(c);let A,h,d;try{const B=await Di(o);A=B.sdr,h=B.gainMap,d=B.metadata}catch(B){if(B instanceof Xr||B instanceof Qr)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),d={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},A=o;else throw B}try{await this.render(s,d,A.buffer,h==null?void 0:h.buffer)}catch(B){this.manager.itemError(e),typeof r=="function"&&r(B),s.disposeOnDemandRenderer();return}typeof n=="function"&&n(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},t,c=>{this.manager.itemError(e),typeof r=="function"&&r(c)}),s}}const rn={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Yr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Nt=l=>Array.isArray(l),zn=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Mn({files:l=zn,path:e="",preset:n=void 0,encoding:t=void 0,extensions:r}={}){let s=null,a=!1;n&&(qn(n),l=rn[n],e=Yr),a=Nt(l);const{extension:c,isCubemap:o}=$n(l);if(s=er(c),!s)throw new Error("useEnvironment: Unrecognized file extension: "+l);const A=we(m=>m.gl);J.useLayoutEffect(()=>{if(c!=="webp"&&c!=="jpg"&&c!=="jpeg")return;function m(){Dt.clear(s,a?[l]:l)}A.domElement.addEventListener("webglcontextlost",m,{once:!0})},[l,A.domElement]);const h=Dt(s,a?[l]:l,m=>{(c==="webp"||c==="jpg"||c==="jpeg")&&m.setRenderer(A),m.setPath==null||m.setPath(e),r&&r(m)});let d=a?h[0]:h;if(c==="jpg"||c==="jpeg"||c==="webp"){var B;d=(B=d.renderTarget)==null?void 0:B.texture}return d.mapping=o?Zs:Ws,"colorSpace"in d?d.colorSpace=t??o?"srgb":"srgb-linear":d.encoding=t??o?Ii:Mi,d}const _i={files:zn,path:"",preset:void 0,extensions:void 0};Mn.preload=l=>{const e={..._i,...l};let{files:n,path:t=""}=e;const{preset:r,extensions:s}=e;r&&(qn(r),n=rn[r],t=Yr);const{extension:a}=$n(n);if(a==="webp"||a==="jpg"||a==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const c=er(a);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+n);Dt.preload(c,Nt(n)?[n]:n,o=>{o.setPath==null||o.setPath(t),s&&s(o)})};const xi={files:zn,preset:void 0};Mn.clear=l=>{const e={...xi,...l};let{files:n}=e;const{preset:t}=e;t&&(qn(t),n=rn[t]);const{extension:r}=$n(n),s=er(r);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+n);Dt.clear(s,Nt(n)?[n]:n)};function qn(l){if(!(l in rn))throw new Error("Preset must be one of: "+Object.keys(rn).join(", "))}function $n(l){var e;const n=Nt(l)&&l.length===6,t=Nt(l)&&l.length===3&&l.some(a=>a.endsWith("json")),r=Nt(l)?l[0]:l;return{extension:n?"cube":t?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(e=r.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:n,isGainmap:t}}function er(l){return l==="cube"?Vs:l==="hdr"?Ci:l==="exr"?gi:l==="jpg"||l==="jpeg"?Hi:l==="webp"?Si:null}const Li=l=>l.current&&l.current.isScene,Oi=l=>Li(l)?l.current:l;function tr(l,e,n,t,r={}){var s,a,c,o;r={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...r};const A=Oi(e||n),h=A.background,d=A.environment,B={backgroundBlurriness:A.backgroundBlurriness,backgroundIntensity:A.backgroundIntensity,backgroundRotation:(s=(a=A.backgroundRotation)==null||a.clone==null?void 0:a.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:A.environmentIntensity,environmentRotation:(c=(o=A.environmentRotation)==null||o.clone==null?void 0:o.clone())!==null&&c!==void 0?c:[0,0,0]};return l!=="only"&&(A.environment=t),l&&(A.background=t),ur(A,r),()=>{l!=="only"&&(A.environment=d),l&&(A.background=h),ur(A,B)}}function nr({scene:l,background:e=!1,map:n,...t}){const r=we(s=>s.scene);return J.useLayoutEffect(()=>{if(n)return tr(e,l,r,n,t)}),null}function Zr({background:l=!1,scene:e,blur:n,backgroundBlurriness:t,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:a,environmentRotation:c,...o}){const A=Mn(o),h=we(d=>d.scene);return J.useLayoutEffect(()=>tr(l,e,h,A,{backgroundBlurriness:n??t,backgroundIntensity:r,backgroundRotation:s,environmentIntensity:a,environmentRotation:c})),J.useEffect(()=>()=>{A.dispose()},[A]),null}function Ui({children:l,near:e=.1,far:n=1e3,resolution:t=256,frames:r=1,map:s,background:a=!1,blur:c,backgroundBlurriness:o,backgroundIntensity:A,backgroundRotation:h,environmentIntensity:d,environmentRotation:B,scene:m,files:g,path:T,preset:M=void 0,extensions:D}){const x=we(F=>F.gl),N=we(F=>F.scene),P=J.useRef(null),[O]=J.useState(()=>new Gr),b=J.useMemo(()=>{const F=new zs(t);return F.texture.type=Ye,F},[t]);J.useEffect(()=>()=>{b.dispose()},[b]),J.useLayoutEffect(()=>{if(r===1){const F=x.autoClear;x.autoClear=!0,P.current.update(x,O),x.autoClear=F}return tr(a,m,N,b.texture,{backgroundBlurriness:c??o,backgroundIntensity:A,backgroundRotation:h,environmentIntensity:d,environmentRotation:B})},[l,O,b.texture,m,N,a,r,x]);let Z=1;return vn(()=>{if(r===1/0||Z<r){const F=x.autoClear;x.autoClear=!0,P.current.update(x,O),x.autoClear=F,Z++}}),J.createElement(J.Fragment,null,$s(J.createElement(J.Fragment,null,l,J.createElement("cubeCamera",{ref:P,args:[e,n,b]}),g||M?J.createElement(Zr,{background:!0,files:g,preset:M,path:T,extensions:D}):s?J.createElement(nr,{background:!0,map:s,extensions:D}):null),O))}function Pi(l){var e,n,t,r;const s=Mn(l),a=l.map||s;J.useMemo(()=>ea({GroundProjectedEnvImpl:Ra}),[]),J.useEffect(()=>()=>{s.dispose()},[s]);const c=J.useMemo(()=>[a],[a]),o=(e=l.ground)==null?void 0:e.height,A=(n=l.ground)==null?void 0:n.radius,h=(t=(r=l.ground)==null?void 0:r.scale)!==null&&t!==void 0?t:1e3;return J.createElement(J.Fragment,null,J.createElement(nr,kt({},l,{map:a})),J.createElement("groundProjectedEnvImpl",{args:c,scale:h,height:o,radius:A}))}function Zi(l){return l.ground?J.createElement(Pi,l):l.map?J.createElement(nr,l):l.children?J.createElement(Ui,l):J.createElement(Zr,l)}const Wi=J.forwardRef(({scale:l=10,frames:e=1/0,opacity:n=1,width:t=1,height:r=1,blur:s=1,near:a=0,far:c=10,resolution:o=512,smooth:A=!0,color:h="#000000",depthWrite:d=!1,renderOrder:B,...m},g)=>{const T=J.useRef(null),M=we(K=>K.scene),D=we(K=>K.gl),x=J.useRef(null);t=t*(Array.isArray(l)?l[0]:l||1),r=r*(Array.isArray(l)?l[1]:l||1);const[N,P,O,b,Z,F,I]=J.useMemo(()=>{const K=new Cn(o,o),V=new Cn(o,o);V.texture.generateMipmaps=K.texture.generateMipmaps=!1;const W=new Xn(t,r).rotateX(Math.PI/2),le=new sn(W),Me=new qs;Me.depthTest=Me.depthWrite=!1,Me.onBeforeCompile=Ee=>{Ee.uniforms={...Ee.uniforms,ucolor:{value:new pt(h)}},Ee.fragmentShader=Ee.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),Ee.fragmentShader=Ee.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const ge=new tn(pi),ee=new tn(mi);return ee.depthTest=ge.depthTest=!1,[K,W,Me,le,ge,ee,V]},[o,t,r,l,h]),U=K=>{b.visible=!0,b.material=Z,Z.uniforms.tDiffuse.value=N.texture,Z.uniforms.h.value=K*1/256,D.setRenderTarget(I),D.render(b,x.current),b.material=F,F.uniforms.tDiffuse.value=I.texture,F.uniforms.v.value=K*1/256,D.setRenderTarget(N),D.render(b,x.current),b.visible=!1};let Y=0,$,z;return vn(()=>{x.current&&(e===1/0||Y<e)&&(Y++,$=M.background,z=M.overrideMaterial,T.current.visible=!1,M.background=null,M.overrideMaterial=O,D.setRenderTarget(N),D.render(M,x.current),U(s),A&&U(s*.4),D.setRenderTarget(null),T.current.visible=!0,M.overrideMaterial=z,M.background=$)}),J.useImperativeHandle(g,()=>T.current,[]),J.createElement("group",kt({"rotation-x":Math.PI/2},m,{ref:T}),J.createElement("mesh",{renderOrder:B,geometry:P,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},J.createElement("meshBasicMaterial",{transparent:!0,map:N.texture,opacity:n,depthWrite:d})),J.createElement("orthographicCamera",{ref:x,args:[-t/2,t/2,r/2,-r/2,a,c]}))});export{Wi as C,Zi as E,Xi as H,Yi as O,Qi as _,wr as c,Wn as u};
